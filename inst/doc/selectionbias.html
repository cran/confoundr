<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="John W. Jackson" />

<meta name="date" content="2019-09-19" />

<title>Describing Selection Bias from Dependent Censoring</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Describing Selection Bias from Dependent Censoring</h1>
<h4 class="author">John W. Jackson</h4>
<h4 class="date">2019-09-19</h4>



<div id="introduction" class="section level1">
<h1>INTRODUCTION</h1>
<p>This software implements three <a href="https://www.ncbi.nlm.nih.gov/pubmed/27479649">diagnostics for confounding/selection-bias</a> that can be used in sequence. Built upon the framework of sequential exchangeability, these apply to any study of multivariate exposures e.g. time-varying exposures, direct effects, interaction, and censoring. The first two diagnostics pertain to the nature of confounding/selection-bias in the data, while the third is meant to examine residual confounding/selection-bias after applying certain adjustment methods. These tools are meant to help describe confounding/selection-bias in complex data <em>after</em> investigators have selected covariates to adjust for (e.g., through subject-matter knowledge).</p>
<ul>
<li><p><em>Diagnostic 1</em> is a generalization of a “Table 1” for multivariate exposures (i.e. multiple exposures that are distinct in timing or character). It examines whether the prior covariate means are the same across exposure groups, among persons who have followed a particular exposure trajectory up to that point in time. Like a “Table 1” it is meant to describe whether exposure groups have different distributions of prior covariates.</p></li>
<li><p><em>Diagnostic 2</em> assesses whether there is feedback between exposures and confounders over time. If present, it indicates the use of <a href="https://www.ncbi.nlm.nih.gov/pubmed/28039382">g-methods</a> to control for time-varying confounding for any definition of time-varying exposure that is explicitly or implicitly multivariate (e.g., ever use at time <span class="math inline">\(t\)</span>). The diagnostic examines whether the covariate mean differs across prior exposure groups, after adjustment for covariates (that precede the exposure) through inverse probability weighting or propensity score stratification.</p></li>
<li><p><em>Diagnostic 3</em> is meant to be applied after investigators have applied the earlier diagnostics and have chosen to use g-methods to adjust for confounding/selection-bias. The form of Diagnostic 3 is similar to that of Diagnostic 1 in that it is a generalized “Table 1” for weighted or stratified data. It can be applied to examine residual confounding/selection-bias when <a href="https://www.ncbi.nlm.nih.gov/pubmed/10955408">inverse probability weights</a> are used to fit Marginal Structural Models. It can also be applied to examine residual confounding/selection-bias when <a href="https://www.ncbi.nlm.nih.gov/pubmed/19817741">propensity-score stratification</a> is used to implement the <a href="https://www.ncbi.nlm.nih.gov/pubmed/?term=23533091">parametric g-formula</a> or <a href="https://www.ncbi.nlm.nih.gov/pubmed/21843003">marginal mean weighting through stratification</a>.</p></li>
</ul>
</div>
<div id="capabilities" class="section level1">
<h1>CAPABILITIES</h1>
<p>The tools can accommodate:</p>
<ul>
<li><p>Multivariate exposures that are binary or categorical (and continuous, when used in concert with modeling, see below).</p></li>
<li><p>Varying temporal depth of covariate history.</p></li>
<li><p>Unbalanced, sparse data with irregular measurement of exposures/covariates or missing data.</p></li>
<li><p>Artificial censoring rules.</p></li>
<li><p>Requests for tables/plots at all times, specific times, or averages over selected dimensions of person-time.</p></li>
<li><p>Data that are not time-indexed.</p></li>
<li><p>Data that are supplied in “wide” or “long” format (e.g., from the <code>twang</code> and <code>CBPS</code> packages).</p></li>
</ul>
</div>
<div id="usage" class="section level1">
<h1>USAGE</h1>
<div id="workflow" class="section level2">
<h2>WORKFLOW</h2>
<p>The software is designed to use data that analysts may readily have on hand in analyses of time-varying exposures. This includes time-varying exposures, time-varying covariates, time-varying weights (when applicable), and time-varying propensity-score strata (when applicable). Time-varying exposure history strata may also be required, and we provide functions to create these from the exposure variables.</p>
<p>The analysis generally proceeds as follows (see below for examples):</p>
<ol style="list-style-type: decimal">
<li><p>Format the data. If needed, use <code>Widen()</code> to transform person-time indexed dataframe into person indexed dataframe. If needed, use <code>makehistory.one()</code> or <code>makehistory.two()</code> to create variables that describe exposure history over time.</p></li>
<li><p>Create a tidy dataframe. Use <code>lengthen()</code> Restructure the wide dataframe into a tidy dataframe indexed by person id, exposure measurement time, and covariate measurement time. If desired, use <code>omit.history()</code> to omit irrelevant covariate history (that will not be used by the analyst to adjust for confounding at time <span class="math inline">\(t\)</span>)</p></li>
<li><p>Create a covariate balance table. Take the tidy dataframe output from <code>lenthen()</code> and use <code>balance()</code> to create a covariate balance table.</p></li>
<li><p>Create a trellised covariate balance plot using <code>makeplot()</code>.</p></li>
</ol>
<p>Let’s go ahead and load the <code>confoundr</code> package. We’ll also load the <code>dplyr</code> package to hep present the results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">library</span>(confoundr)</code></pre></div>
</div>
<div id="demonstration-of-diagnostic-1" class="section level2">
<h2>DEMONSTRATION OF DIAGNOSTIC 1</h2>
<p>Suppose we wished to evaluate the comparative effectiveness of five medications on reducing positive and negative symptoms scale in patients with schizophrenia. Our simulated data are loosely based on a large comparative effectiveness trial, the <a href="https://www.ncbi.nlm.nih.gov/pubmed/16172203">CATIE Study</a>, available from the <a href="https://ndar.nih.gov/">National Institutes of Mental Health</a>. Like many trials in this therapeutic area, it is plagued with high rates of dropout, and decisions to leave the study are sometimes informative of worsening symptom response. Such dropout can bias estimates of comparative effectiveness, <a href="https://www.ncbi.nlm.nih.gov/pubmed/?term=28535177">even when dropout rates are similar across arms</a>.</p>
<p>Inverse Probability of Censoring Weights are often used to correct such dropout under certain assumptions about the dropout process. For example, one might assume that the data censored by dropout are Missing at Random given most recent measures of covariates and the treatment arm. If the weights are estimated well, the weighted population will exhibit no association between measures of symptom response and later dropout over time. We will use the <code>confoundr</code> diagnostics to first describe these associations in the raw data, before weighting, and then after inverse probability weights have been applied.</p>
<p>Let’s load the data from our simulated trial:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;catie_sim&quot;</span>)</code></pre></div>
<p>In this simulated trial, we have five treatment arms, with measures of symptom response, patient-reported outcomes, and history of treatment change, measured monthly or quarterly over 18 months (i.e., 0,1,3,6,9,12,15,18). We assume that, at each follow-up visit, study dropout is missing at random given the most recent measures, the treatment arm, and baseline covariates among those who have remained in the study. Here is a description of some baseline covariates:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">catie_sim <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(time<span class="op">==</span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;age.grp.&quot;</span>),white,black,other,exacer,unemployed,<span class="kw">starts_with</span>(<span class="st">&quot;site&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize_all</span>(<span class="st">&quot;mean&quot;</span>)
<span class="co">#&gt; # A tibble: 1 x 14</span>
<span class="co">#&gt;   age.grp.1824 age.grp.2534 age.grp.3544 age.grp.4554 age.grp.5567 white</span>
<span class="co">#&gt;          &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1        0.594        0.347       0.0594            0            0 0.623</span>
<span class="co">#&gt; # ... with 8 more variables: black &lt;dbl&gt;, other &lt;dbl&gt;, exacer &lt;dbl&gt;,</span>
<span class="co">#&gt; #   unemployed &lt;dbl&gt;, site.ro &lt;dbl&gt;, site.sh &lt;dbl&gt;, site.uc &lt;dbl&gt;,</span>
<span class="co">#&gt; #   site.va &lt;dbl&gt;</span></code></pre></div>
<p>(Most of the names are self-explanatory, but exacer refers to a recent hospitalization, and site is the type of clinical trial study site).</p>
<p>Here is a description of time-varying covariates:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">catie_sim <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(time) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Chg.pansstotal,cs14,cs16,calg1,epsmean,qoltot,Chg.pansstotal,pct.gain,phase.change.cum,studydisc) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize_all</span>(<span class="st">&quot;mean&quot;</span>)
<span class="co">#&gt; Adding missing grouping variables: `time`</span>
<span class="co">#&gt; # A tibble: 8 x 10</span>
<span class="co">#&gt;    time Chg.pansstotal  cs14  cs16 calg1 epsmean qoltot pct.gain</span>
<span class="co">#&gt;   &lt;int&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1     0          0      1.30  3.84  1.81   0.207   2.74   0     </span>
<span class="co">#&gt; 2     1         -0.502  1.31  3.82  1.80   0.201   2.75   0.0150</span>
<span class="co">#&gt; 3     3         -1.53   1.31  3.76  1.77   0.196   2.80   0.0481</span>
<span class="co">#&gt; 4     6         -3.02   1.29  3.69  1.73   0.190   2.86   0.0934</span>
<span class="co">#&gt; 5     9         -4.50   1.28  3.61  1.69   0.184   2.90   0.136 </span>
<span class="co">#&gt; 6    12         -5.99   1.28  3.53  1.65   0.177   2.95   0.186 </span>
<span class="co">#&gt; 7    15         -7.46   1.26  3.46  1.61   0.170   3.00   0.238 </span>
<span class="co">#&gt; 8    18         -8.90   1.26  3.38  1.58   0.164   3.03   0.278 </span>
<span class="co">#&gt; # ... with 2 more variables: phase.change.cum &lt;dbl&gt;, studydisc &lt;dbl&gt;</span></code></pre></div>
<ul>
<li>Chg.pansstotal: change in total positive and negative syndrome scale (PANSS) from baseline</li>
<li>cs14: Drug use scale</li>
<li>cs16: Clinical Global Illness (CGI) Severity Index score</li>
<li>calg1: Calgary Depression score</li>
<li>epsmean: Simpson-Agnes extrapyramidal symptoms score</li>
<li>qoltot: Quality of life score</li>
<li>pct.gain: Percent weight gain from baseline</li>
<li>phase.change.cum: Number of treatment changes</li>
<li>studydisc: Study dropout by time <span class="math inline">\(t+1\)</span></li>
</ul>
<p>Before we begin, a few clarifying points about this example may be helpful. Our use of the diagnostics in this example is akin to assessing covariate balance across levels of study dropout. That is, we are treating study dropout as an exposure. The sticky point here is that we define study dropout as equal to <code>1</code> at the last visit and <code>0</code> at all times before. This means that we are actually evaluating censoring due to study dropout at time <span class="math inline">\(t+1\)</span>, indexed at time <span class="math inline">\(t\)</span>, as is done in most applied studies that use inverse probability of censoring weights.</p>
<p>Now let us proceed with our first step, to use Diagnostic 1 to describe the selection-bias in the data, e.g., how the covariates are <em>not</em> missing completely at random over time (that is, showing that censoring due to dropout depends at least on measured covariates).</p>
<div id="step-1-format-the-dataframe" class="section level3">
<h3>STEP 1: FORMAT THE DATAFRAME</h3>
<p>Our data formats should obey the following conventions:</p>
<ul>
<li>All covariates should be numeric</li>
<li>Underscores should <em>not</em> appear in any variable root name.</li>
<li>Exposures
<ul>
<li>A common referent value–to which balance metrics will compare all other levels–should be coded as the lowest value</li>
<li>In our examples, we have two exposures. The first is treatment assignment, <code>treat.grp</code>. It is coded numerically as one variable, with the numbers indicating treatment arm at baseline. The second exposure is censoring due to study dropout, <code>studydisc</code>, which equals <span class="math inline">\(1\)</span> at a participant’s last visit when they exit the study prematurely, and <span class="math inline">\(0\)</span> otherwise.</li>
</ul></li>
<li>Covariates
<ul>
<li>All categorical covariates should be broken up into numeric indicator variables.</li>
</ul></li>
</ul>
<p>For example, here is a snapshot of our example data (e.g., the simulated person CATIEID=1440 who dropped out after completing three study visits:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(catie_sim <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(CATIEID,time,treat.grp,studydisc,pct.gain) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(CATIEID<span class="op">==</span><span class="dv">1440</span>))
<span class="co">#&gt; # A tibble: 3 x 5</span>
<span class="co">#&gt;   CATIEID  time treat.grp studydisc pct.gain</span>
<span class="co">#&gt;     &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1    1440     0         1         0   0     </span>
<span class="co">#&gt; 2    1440     1         1         0   0.0194</span>
<span class="co">#&gt; 3    1440     3         1         1   0.0581</span></code></pre></div>
<p>Our example data is currently indexed by person-id and time (i.e., it’s in “long” format). We need to convert our data into a version that is indexed by person-id (i.e., “wide” format). We use the <code>widen()</code> function to accomplish this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">catie_sim.w &lt;-<span class="st"> </span><span class="kw">widen</span>(
 <span class="dt">input=</span>catie_sim,
 <span class="dt">id=</span><span class="st">&quot;CATIEID&quot;</span>,
 <span class="dt">time=</span><span class="st">&quot;time&quot;</span>,
 <span class="dt">exposure=</span><span class="st">&quot;studydisc&quot;</span>,
 <span class="dt">covariate=</span><span class="kw">c</span>(<span class="st">&quot;treat.grp&quot;</span>,<span class="st">&quot;phase.change.cum&quot;</span>,
             <span class="st">&quot;Chg.pansstotal&quot;</span>,<span class="st">&quot;cs14&quot;</span>,
             <span class="st">&quot;cs16&quot;</span>,<span class="st">&quot;pct.gain&quot;</span>,
             <span class="st">&quot;epsmean&quot;</span>,<span class="st">&quot;qoltot&quot;</span>,
             <span class="st">&quot;exacer&quot;</span>,<span class="st">&quot;Bpansstotal&quot;</span>,
             <span class="st">&quot;unemployed&quot;</span>),
 <span class="dt">weight.exposure=</span><span class="st">&quot;wtr&quot;</span>             
)
<span class="co">#&gt; Adding missing grouping variables: `ID`</span>
<span class="kw">glimpse</span>(catie_sim.w <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(CATIEID,<span class="kw">starts_with</span>(<span class="st">&quot;treat.grp&quot;</span>),<span class="kw">starts_with</span>(<span class="st">&quot;studydisc&quot;</span>),<span class="kw">starts_with</span>(<span class="st">&quot;pct.gain&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(CATIEID<span class="op">==</span><span class="dv">1440</span>))
<span class="co">#&gt; Observations: 1</span>
<span class="co">#&gt; Variables: 25</span>
<span class="co">#&gt; $ CATIEID      &lt;int&gt; 1440</span>
<span class="co">#&gt; $ treat.grp_0  &lt;dbl&gt; 1</span>
<span class="co">#&gt; $ treat.grp_1  &lt;dbl&gt; 1</span>
<span class="co">#&gt; $ treat.grp_12 &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ treat.grp_15 &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ treat.grp_18 &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ treat.grp_3  &lt;dbl&gt; 1</span>
<span class="co">#&gt; $ treat.grp_6  &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ treat.grp_9  &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ studydisc_0  &lt;dbl&gt; 0</span>
<span class="co">#&gt; $ studydisc_1  &lt;dbl&gt; 0</span>
<span class="co">#&gt; $ studydisc_12 &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ studydisc_15 &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ studydisc_18 &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ studydisc_3  &lt;dbl&gt; 1</span>
<span class="co">#&gt; $ studydisc_6  &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ studydisc_9  &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ pct.gain_0   &lt;dbl&gt; 0</span>
<span class="co">#&gt; $ pct.gain_1   &lt;dbl&gt; 0.01935687</span>
<span class="co">#&gt; $ pct.gain_12  &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ pct.gain_15  &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ pct.gain_18  &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ pct.gain_3   &lt;dbl&gt; 0.0580706</span>
<span class="co">#&gt; $ pct.gain_6   &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ pct.gain_9   &lt;dbl&gt; NA</span></code></pre></div>
<p>In this wide dataset, each variable measurement appears as its own variable, indexed by time (e.g., <code>var_0, var_1, var_3, var_6, ...</code>), including static covariates that are measured at baseline and do not change over time. Generally, any scheme can be used to index time (e.g., <code>var_0, var_1, var_2, ...</code>) and it could be arbitrarily different for each covariate, supporting heterogeneous covariate measurement schedules as is common in clinical trial and cohort studies.</p>
<p>There is one more housekeeping task. If we wish to obtain balance diagnostics that adjust for prior exposure history, or for a categorical baseline variable, we can use the <code>makehistory.one()</code> or (<code>makehistory.two()</code>) function to create these measures in the “wide” dataset. This will create a variable that describes exposure history through time <span class="math inline">\(t-1\)</span>, indexed at time <span class="math inline">\(t\)</span>, possibly stratified by a baseline covariate measurement. In our example, we want to first compare covariate balance across treatment arms. Because this exposure is static, it needs no history variable. We also want to compare at each time <span class="math inline">\(t\)</span> the censored vs. the uncensored, among those in the same treatment arm who have remained uncensored before time <span class="math inline">\(t\)</span>. Thus, we need a history variable for censoring that tells us which treatment arm they belong to, and summarizes their censoring history.</p>
<p>We can create the appropriate history strata for our example by using <code>makehistory.two()</code>, with treatment arm as the first exposure and studydropout as the second:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">catie_sim.wh &lt;-<span class="st"> </span><span class="kw">makehistory.two</span>(
 <span class="dt">input=</span>catie_sim.w,
 <span class="dt">id=</span><span class="st">&quot;CATIEID&quot;</span>,
 <span class="dt">exposure.a=</span><span class="st">&quot;treat.grp&quot;</span>,
 <span class="dt">exposure.b=</span><span class="st">&quot;studydisc&quot;</span>,
 <span class="dt">times=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">15</span>,<span class="dv">18</span>),
 <span class="dt">name.history.a=</span><span class="st">&quot;ht&quot;</span>,
 <span class="dt">name.history.b=</span><span class="st">&quot;hs&quot;</span>
)
<span class="kw">glimpse</span>(catie_sim.wh <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(CATIEID,<span class="kw">starts_with</span>(<span class="st">&quot;pct.gain&quot;</span>),<span class="kw">starts_with</span>(<span class="st">&quot;treat.grp&quot;</span>),<span class="kw">starts_with</span>(<span class="st">&quot;studydisc&quot;</span>),<span class="kw">starts_with</span>(<span class="st">&quot;ht&quot;</span>),<span class="kw">starts_with</span>(<span class="st">&quot;hs&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(CATIEID<span class="op">==</span><span class="dv">1440</span>))
<span class="co">#&gt; Observations: 1</span>
<span class="co">#&gt; Variables: 41</span>
<span class="co">#&gt; $ CATIEID      &lt;int&gt; 1440</span>
<span class="co">#&gt; $ pct.gain_0   &lt;dbl&gt; 0</span>
<span class="co">#&gt; $ pct.gain_1   &lt;dbl&gt; 0.01935687</span>
<span class="co">#&gt; $ pct.gain_12  &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ pct.gain_15  &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ pct.gain_18  &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ pct.gain_3   &lt;dbl&gt; 0.0580706</span>
<span class="co">#&gt; $ pct.gain_6   &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ pct.gain_9   &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ treat.grp_0  &lt;dbl&gt; 1</span>
<span class="co">#&gt; $ treat.grp_1  &lt;dbl&gt; 1</span>
<span class="co">#&gt; $ treat.grp_12 &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ treat.grp_15 &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ treat.grp_18 &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ treat.grp_3  &lt;dbl&gt; 1</span>
<span class="co">#&gt; $ treat.grp_6  &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ treat.grp_9  &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ studydisc_0  &lt;dbl&gt; 0</span>
<span class="co">#&gt; $ studydisc_1  &lt;dbl&gt; 0</span>
<span class="co">#&gt; $ studydisc_12 &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ studydisc_15 &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ studydisc_18 &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ studydisc_3  &lt;dbl&gt; 1</span>
<span class="co">#&gt; $ studydisc_6  &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ studydisc_9  &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ ht_0         &lt;chr&gt; &quot;H&quot;</span>
<span class="co">#&gt; $ ht_1         &lt;chr&gt; &quot;H10&quot;</span>
<span class="co">#&gt; $ ht_12        &lt;chr&gt; &quot;H101011NANANANA&quot;</span>
<span class="co">#&gt; $ ht_15        &lt;chr&gt; &quot;H101011NANANANANANA&quot;</span>
<span class="co">#&gt; $ ht_18        &lt;chr&gt; &quot;H101011NANANANANANANANA&quot;</span>
<span class="co">#&gt; $ ht_3         &lt;chr&gt; &quot;H1010&quot;</span>
<span class="co">#&gt; $ ht_6         &lt;chr&gt; &quot;H101011&quot;</span>
<span class="co">#&gt; $ ht_9         &lt;chr&gt; &quot;H101011NANA&quot;</span>
<span class="co">#&gt; $ hs_0         &lt;chr&gt; &quot;H1&quot;</span>
<span class="co">#&gt; $ hs_1         &lt;chr&gt; &quot;H101&quot;</span>
<span class="co">#&gt; $ hs_12        &lt;chr&gt; &quot;H101011NANANANANA&quot;</span>
<span class="co">#&gt; $ hs_15        &lt;chr&gt; &quot;H101011NANANANANANANA&quot;</span>
<span class="co">#&gt; $ hs_18        &lt;chr&gt; &quot;H101011NANANANANANANANANA&quot;</span>
<span class="co">#&gt; $ hs_3         &lt;chr&gt; &quot;H10101&quot;</span>
<span class="co">#&gt; $ hs_6         &lt;chr&gt; &quot;H101011NA&quot;</span>
<span class="co">#&gt; $ hs_9         &lt;chr&gt; &quot;H101011NANANA&quot;</span></code></pre></div>
<p>In our example, we can ignore the treatment arm history variables “ht” that <code>makehistory.two()</code> created since treatment arm is fixed throughout the study. Note that the <code>makehistory.one()</code> and <code>make.history.two()</code> functions allow users to stratify history variables by a baseline covariate via the <code>group</code> argument. It should never be used for a true exposure, as doing so would inaccurately classify any persons who intermittently miss visits throughout the study.</p>
</div>
<div id="step-2-create-a-tidy-dataframe" class="section level3">
<h3>STEP 2: CREATE A TIDY DATAFRAME</h3>
<p>The next step is to use <code>lengthen()</code> to transform our wide dataframe into one that is jointly indexed by person-id, exposure measurement time, and covariate measurement time (i.e., tidy). This data structure is the secret sauce that allows for much of this software’s flexibility. Here, we have to specify which diagnostic we want because the tidy structure for diagnostic 2 (exposure-covariate feedback) differs from the one used for diagnostics 1 and 3 (time-varying confounding/selection-bias).</p>
<p>When creating this tidy dataset, <code>lengthen()</code> automatically deletes observations that have missing measurements for exposure or a specific covariate at a given time. Thus, it carries out a form of complete case assessment by default. There is a mandatory <code>censoring</code> argument that we have to supply to let <code>lengthen()</code> know whether there are additional observations to remove according to an artificial censoring rule. Since we are evaluating balance for censoring due to study dropout, and all data after study dropout are missing, we don’t need any artificial censoring rules to remove data after study dropout, so we set the <code>censoring</code> argument to <code>&quot;no&quot;</code>. However, if we were evaluating balance for censoring due to treatment protocol deviation, we would need to set censoring to <code>&quot;yes&quot;</code> and use the <code>censor</code> argument to specify the appropriate indicator variable <code>(0=drop, 1=keep)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">catie_sim.whl1 &lt;-<span class="st"> </span><span class="kw">lengthen</span>(
  <span class="dt">input=</span>catie_sim.wh,
  <span class="dt">id=</span><span class="st">&quot;CATIEID&quot;</span>,
  <span class="dt">diagnostic=</span><span class="dv">1</span>,
  <span class="dt">censoring=</span><span class="st">&quot;no&quot;</span>,
  <span class="dt">exposure=</span><span class="st">&quot;studydisc&quot;</span>,
  <span class="dt">temporal.covariate=</span><span class="kw">c</span>(<span class="st">&quot;phase.change.cum&quot;</span>,<span class="st">&quot;Chg.pansstotal&quot;</span>,
                       <span class="st">&quot;cs14&quot;</span>,<span class="st">&quot;cs16&quot;</span>,
                       <span class="st">&quot;pct.gain&quot;</span>,<span class="st">&quot;epsmean&quot;</span>,
                       <span class="st">&quot;qoltot&quot;</span>),
  <span class="dt">times.exposure=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">15</span>,<span class="dv">18</span>), 
  <span class="dt">times.covariate=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">15</span>,<span class="dv">18</span>),
  <span class="dt">history=</span><span class="st">&quot;hs&quot;</span>
)
<span class="co">#&gt; Warning in lengthen(input = catie_sim.wh, id = &quot;CATIEID&quot;, diagnostic =</span>
<span class="co">#&gt; 1, : The exposure and/or some covariates contain missing data. Subsequent</span>
<span class="co">#&gt; calculations are not guaranteed to be unbiased in the presence of partially</span>
<span class="co">#&gt; missing data.</span>
<span class="kw">glimpse</span>(catie_sim.whl1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(CATIEID<span class="op">==</span><span class="dv">1440</span> <span class="op">&amp;</span><span class="st"> </span>name.cov<span class="op">==</span><span class="st">&quot;pct.gain&quot;</span>))
<span class="co">#&gt; Observations: 6</span>
<span class="co">#&gt; Variables: 7</span>
<span class="co">#&gt; $ CATIEID        &lt;chr&gt; &quot;1440&quot;, &quot;1440&quot;, &quot;1440&quot;, &quot;1440&quot;, &quot;1440&quot;, &quot;1440&quot;</span>
<span class="co">#&gt; $ name.cov       &lt;chr&gt; &quot;pct.gain&quot;, &quot;pct.gain&quot;, &quot;pct.gain&quot;, &quot;pct.gain&quot;,...</span>
<span class="co">#&gt; $ time.exposure  &lt;dbl&gt; 0, 1, 1, 3, 3, 3</span>
<span class="co">#&gt; $ time.covariate &lt;dbl&gt; 0, 0, 1, 0, 1, 3</span>
<span class="co">#&gt; $ hs             &lt;chr&gt; &quot;H1&quot;, &quot;H101&quot;, &quot;H101&quot;, &quot;H10101&quot;, &quot;H10101&quot;, &quot;H10101&quot;</span>
<span class="co">#&gt; $ studydisc      &lt;dbl&gt; 0, 0, 0, 1, 1, 1</span>
<span class="co">#&gt; $ value.cov      &lt;dbl&gt; 0.00000000, 0.00000000, 0.01935687, 0.00000000,...</span></code></pre></div>
<p>You should notice that <code>lengthen()</code> has produced a tidy dataframe where, for diagnostic 1, exposure times are greater or equal to covariate times.</p>
<div id="omitting-covariate-history" class="section level4">
<h4>Omitting covariate history</h4>
<p>We can use <code>omit.history()</code> to ensure that our balance evaluations accord with our assumption that, at each follow-up visit, study dropout is missing at random given the most recent measures of time-varying covariates, the treatment arm, and baseline covariates. The <code>omit.history()</code> function requires that users specify the covariates to be modified (via the <code>covariate</code> argument), and how they want to remove irrelevant covariate history (via the <code>omission</code> argument). There are three types of omissions that can be specified:</p>
<ul>
<li><p><code>&quot;fixed&quot;</code>: sets covariate values to missing for certain measurement times <span class="math inline">\(t\)</span> (specified in the <code>times</code> argument). For example, we might use this for covariate “l” at time 2 to set all data on “l” at time 2 to missing, regardless of the exposure measurement time.</p></li>
<li><p><code>&quot;relative&quot;</code>: sets covariate values to missing only for covariate measurement times at or before a certan distance <span class="math inline">\(k\)</span> from the exposure measurement times (specified in <code>distance</code> argument). For example, we might use this to set data for covariate “l” with distance 2 to missing data only when it is measured two units or more before the exposure measurement time (i.e. <span class="math inline">\(t-2, t-3, t-4\)</span> and so on).</p></li>
<li><p><code>&quot;same.time&quot;</code>: sets covariate values to missing only for covariate measurement times that align with exposure measurement times (no additional argument needed). This can be useful when, at any given time, an exposure precedes a particular covariate.</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">catie_sim.whlo1 &lt;-<span class="st"> </span><span class="kw">omit.history</span>(
  <span class="dt">input=</span>catie_sim.whl1,
  <span class="dt">covariate.name=</span><span class="kw">c</span>(<span class="st">&quot;phase.change.cum&quot;</span>,<span class="st">&quot;Chg.pansstotal&quot;</span>,
                   <span class="st">&quot;cs14&quot;</span>,<span class="st">&quot;cs16&quot;</span>,<span class="st">&quot;pct.gain&quot;</span>,
                   <span class="st">&quot;epsmean&quot;</span>,<span class="st">&quot;qoltot&quot;</span>),
  <span class="dt">omission=</span><span class="st">&quot;relative&quot;</span>,
  <span class="dt">distance=</span><span class="st">&quot;1&quot;</span>
)
<span class="kw">glimpse</span>(catie_sim.whlo1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(CATIEID<span class="op">==</span><span class="dv">1440</span> <span class="op">&amp;</span><span class="st"> </span>name.cov<span class="op">==</span><span class="st">&quot;pct.gain&quot;</span>))
<span class="co">#&gt; Observations: 3</span>
<span class="co">#&gt; Variables: 7</span>
<span class="co">#&gt; $ CATIEID        &lt;chr&gt; &quot;1440&quot;, &quot;1440&quot;, &quot;1440&quot;</span>
<span class="co">#&gt; $ name.cov       &lt;chr&gt; &quot;pct.gain&quot;, &quot;pct.gain&quot;, &quot;pct.gain&quot;</span>
<span class="co">#&gt; $ time.exposure  &lt;dbl&gt; 0, 1, 3</span>
<span class="co">#&gt; $ time.covariate &lt;dbl&gt; 0, 1, 3</span>
<span class="co">#&gt; $ hs             &lt;chr&gt; &quot;H1&quot;, &quot;H101&quot;, &quot;H10101&quot;</span>
<span class="co">#&gt; $ studydisc      &lt;dbl&gt; 0, 0, 1</span>
<span class="co">#&gt; $ value.cov      &lt;dbl&gt; 0.00000000, 0.01935687, 0.05807060</span></code></pre></div>
<p>Because omit.history can be applied repeatedly to the dataset output from <code>lengthen()</code>, users can encode different depths of covariate history for each covariate, if desired.</p>
</div>
</div>
<div id="step-3-create-a-covariate-balance-table" class="section level3">
<h3>STEP 3: CREATE A COVARIATE BALANCE TABLE</h3>
<p>Now we are ready to use <code>balance()</code> to create a balance table comparing the censored to the uncensored over time. As was the case with <code>lengthen()</code> we have to specify what we want to do. The requirements vary (and are detailed further down) but at minimum we need to specify the <code>diagnostic</code> of interest, what <code>approach</code> is used to adjust the diagnostic (if any), whether or not additional <code>censoring</code> rules are to be applied, and the measurement times of interest for exposures and covariates.</p>
<p>We also have to specify the <code>scope</code> through which we will examine person-time.</p>
<ul>
<li><p><code>&quot;all&quot;</code> provides balance metrics for each exposure-covariate time pairing in the tidy dataset.</p></li>
<li><p><code>&quot;average&quot;</code> provides balance metrics that standardize over different dimensions of person-time. An additional argument, <code>average.over</code> is used to specify the dimension to be averaged over:</p></li>
<li><p><code>&quot;strata&quot;</code> averages over strata within levels of exposure values, history, time, and distance</p></li>
<li><p><code>&quot;values&quot;</code> averages over strata, non-referent exposure values within levels of history, time, and distance</p></li>
<li><p><code>&quot;history&quot;</code> averages over strata, non-referent exposure values and history within levels of time and distance</p></li>
<li><p><code>&quot;time&quot;</code> averages over strata, non-referent exposure values, history, and time within levels of distance</p></li>
<li><p><code>&quot;distance&quot;</code> averages over non-referent exposure values, history, time and distance. If desired, once can use the additional argument <code>periods</code> to average over segmented pools of distance, as shown later on.</p></li>
<li><p><code>&quot;recent&quot;</code> provides balance metrics only for a chosen distance <span class="math inline">\(k\)</span> (specified with the additional argument ‘recency’). Specifying a <code>scope=&quot;recent&quot;</code> with <code>recency=0</code> is a quick way to assess balance for the most recent covariate measurements.</p></li>
</ul>
<p>There are optional arguments that can help us cope with sparse data. For example, in our example, we can optionally specify <code>sd.ref</code> to calculate the standardized mean difference using the covariate standard deviation from the uncensored at time <span class="math inline">\(t\)</span> given censoring history (the default uses the corresponding pooled estimate). If we were taking averages over person-time, we can use <code>ignore.missing.metric</code> to decide whether or not to report standardized mean differences when some dimensions of person-time lack variation in a covariate (or cases where everyone or no one is censored given history).</p>
<p>For our example, in line with our assumptions, let us examine balance for the most recent covariates:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">baltbl1 &lt;-<span class="st"> </span><span class="kw">balance</span>(
  <span class="dt">input=</span>catie_sim.whlo1,
  <span class="dt">diagnostic=</span><span class="dv">1</span>,
  <span class="dt">approach=</span><span class="st">&quot;none&quot;</span>,
  <span class="dt">censoring=</span><span class="st">&quot;no&quot;</span>,
  <span class="dt">scope=</span><span class="st">&quot;recent&quot;</span>,
  <span class="dt">recency=</span><span class="dv">0</span>,
  <span class="dt">exposure=</span><span class="st">&quot;studydisc&quot;</span>,
  <span class="dt">history=</span><span class="st">&quot;hs&quot;</span>,
  <span class="dt">times.exposure=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">15</span>,<span class="dv">18</span>),
  <span class="dt">times.covariate=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">15</span>,<span class="dv">18</span>),
  <span class="dt">sd.ref=</span><span class="st">&quot;yes&quot;</span>
)
<span class="co">#&gt; Warning in balance(input = catie_sim.whlo1, diagnostic = 1, approach =</span>
<span class="co">#&gt; &quot;none&quot;, : Some exposure times have no exposure variation within levels of</span>
<span class="co">#&gt; exposure history. Estimates for these times will not appear in the results</span>
<span class="kw">print</span>(baltbl1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(name.cov<span class="op">==</span><span class="st">&quot;pct.gain&quot;</span> <span class="op">&amp;</span><span class="st"> </span>time.exposure<span class="op">&lt;=</span><span class="dv">6</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="kw">c</span>(<span class="st">&quot;D&quot;</span>,<span class="st">&quot;SMD&quot;</span>),round,<span class="dv">3</span>))
<span class="co">#&gt;    E        H name.cov time.exposure time.covariate      D    SMD   N Nexp</span>
<span class="co">#&gt; 1  1       H1 pct.gain             0              0  0.000  0.000 345   29</span>
<span class="co">#&gt; 2  1     H101 pct.gain             1              1 -0.015 -0.314 316   34</span>
<span class="co">#&gt; 3  1   H10101 pct.gain             3              3  0.016  0.113 282   36</span>
<span class="co">#&gt; 4  1 H1010101 pct.gain             6              6 -0.086 -0.293 246   21</span>
<span class="co">#&gt; 5  1       H2 pct.gain             0              0  0.000  0.000 347   27</span>
<span class="co">#&gt; 6  1     H202 pct.gain             1              1 -0.026 -0.496 320   37</span>
<span class="co">#&gt; 7  1   H20202 pct.gain             3              3  0.002  0.011 283   30</span>
<span class="co">#&gt; 8  1 H2020202 pct.gain             6              6  0.010  0.032 253   20</span>
<span class="co">#&gt; 9  1       H3 pct.gain             0              0  0.000  0.000 310   24</span>
<span class="co">#&gt; 10 1     H303 pct.gain             1              1  0.008  0.164 286   25</span>
<span class="co">#&gt; 11 1   H30303 pct.gain             3              3  0.042  0.273 261   24</span>
<span class="co">#&gt; 12 1 H3030303 pct.gain             6              6  0.303  1.168 237   16</span>
<span class="co">#&gt; 13 1       H4 pct.gain             0              0  0.000  0.000 183   11</span>
<span class="co">#&gt; 14 1     H404 pct.gain             1              1 -0.010 -0.186 172   12</span>
<span class="co">#&gt; 15 1   H40404 pct.gain             3              3 -0.051 -0.315 160   15</span>
<span class="co">#&gt; 16 1 H4040404 pct.gain             6              6 -0.021 -0.063 145   15</span>
<span class="co">#&gt; 17 1       H5 pct.gain             0              0  0.000  0.000 244   17</span>
<span class="co">#&gt; 18 1     H505 pct.gain             1              1 -0.006 -0.114 227   16</span>
<span class="co">#&gt; 19 1   H50505 pct.gain             3              3  0.028  0.182 211   26</span>
<span class="co">#&gt; 20 1 H5050505 pct.gain             6              6 -0.076 -0.245 185    9</span></code></pre></div>
<p>In the table produced by <code>balance()</code>, <code>E</code> is the exposure value that the referent value is compared to, <code>H</code> is the exposure history. The exact format of the output table will depend on the arguments supplied to <code>balance()</code>. There are two reasons for this. The first reason is that diagnostics 1, 2, and 3 differ in when they require exposure history <code>H</code> and strata <code>S</code> (see below for more details), and these variables will only appear when they have been used to adjust the balance estimate. The second reason kicks in when using <code>scope=&quot;average&quot;</code> and <code>average.over=&quot;...&quot;</code> to request balance estimates that average over some dimension of persion-time.</p>
</div>
<div id="step-4-create-a-covariate-balance-plot" class="section level3">
<h3>STEP 4: CREATE A COVARIATE BALANCE PLOT</h3>
<p>Our final step is to use <code>makeplot()</code> to create a trellised covariate balance plot. The required syntax is detailed below, but it is typically short. All that is required is to specify <code>diagnostic</code>, <code>approach</code>, <code>censoring</code>, and <code>scope</code> (and if need be, <code>average.over</code>) which should all follow the parameters specified in <code>balance()</code>. These are sufficient to tell <code>makeplot()</code> what kind of plot to produce, regardless of the underlying data. There are a host of optional formatting arguments that you can use to produce publication-quality plots. See <code>?makeplot</code> for details.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">balplot1 &lt;-<span class="kw">makeplot</span>(
  <span class="dt">input=</span>baltbl1,
  <span class="dt">diagnostic=</span><span class="dv">1</span>,
  <span class="dt">approach=</span><span class="st">&quot;none&quot;</span>,
  <span class="dt">censoring=</span><span class="st">&quot;no&quot;</span>,
  <span class="dt">scope=</span><span class="st">&quot;recent&quot;</span>,
  <span class="dt">label.exposure=</span><span class="st">&quot;Study Dropout&quot;</span>,
  <span class="dt">label.covariate=</span><span class="st">&quot;Covariate&quot;</span>
)
balplot1</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>This plot shows the standardized mean difference (x-axis) for each covariate (y-axis) at different pairings of dropout and covariate measurement times (panels), among the uncensored in each treatment arm (dots). This plot portrays our decision to restrict our pairing of times to those where covariates are measured just prior to dropout. We see here that several covariates are strongly associated with dropout over time, with standarized mean differences much larger than 0.25 (the chosen reference lines).</p>
<p>The plot produced by <code>makeplot()</code> will vary according to the parameters, which should share those used with <code>balance()</code>. For example, if we had used <code>scope=&quot;all&quot;</code> with <code>balance()</code> and <code>makeplot()</code>, this would have arrayed the dropout and measurment parings across a two-dimensional grid, where panel columns correspond to covariate measurement times and panel rows correspond to dropout times. Such displays are useful for distinguishing balance of “static” covariates that do not vary over time from “temporal” covariates that do (as shown below). Sometimes, it is not possible to estimate certain balance metrics due to lack of variation, as would happen if everyone dropped out or shared the same covariate value. When this happens, <code>makeplot()</code> will warn you about how many balance estimates are missing from the plot. You can identify these data elements in the balance table where their balance estimates will have missing values.</p>
<p>We can use optional arguments in <code>makeplot()</code> to produce a publication-quality plot. See <code>?makeplot</code> for details. Once we are satisfied with the format, we can use <code>ggsave()</code> function from the <code>ggplot2()</code> package to save the plot as a PDF with a desired height and width. For example:</p>
<pre><code>#ggsave(balplot1,&quot;balplot1.pdf&quot;,height=7.5,width=10,units=&quot;in&quot;)</code></pre>
</div>
<div id="demonstration-of-diagnostic-3" class="section level3">
<h3>DEMONSTRATION OF DIAGNOSTIC 3</h3>
<p>We have seen with diagnostic 1 that there is dependent-censoring over time. That is, study dropout is associated with measured covariates. Suppose we wish to remove dependent-censoring by using inverse probability of censoring weights to balance these covariates across levels of study dropout. We can use diagnostic 3 to examine how well our estimated weights accomplish this task. For demonstration purposes, we are going to pursue a different plot that incorporates balance across static covariates measured at baseline, using a limited selection of times to keep the plot readable.</p>
<p>To start, we return to our widened dataset and transform it to a tidy dataset under diagnostic 3. The call differs from before only in that we have added two extra arguments, <code>static.covariate</code> and <code>weight.exposure</code>. (If we had specified these for diagnostic 1, we wouldn’t need to reproduce a tidy dataset, because it will share the same structure for diagnostics 1 and 3).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">catie_sim.whl3 &lt;-<span class="st"> </span><span class="kw">lengthen</span>(
  <span class="dt">input=</span>catie_sim.wh,
  <span class="dt">id=</span><span class="st">&quot;CATIEID&quot;</span>,
  <span class="dt">diagnostic=</span><span class="dv">3</span>,
  <span class="dt">censoring=</span><span class="st">&quot;no&quot;</span>,
  <span class="dt">exposure=</span><span class="st">&quot;studydisc&quot;</span>,
  <span class="dt">temporal.covariate=</span><span class="kw">c</span>(<span class="st">&quot;phase.change.cum&quot;</span>,<span class="st">&quot;Chg.pansstotal&quot;</span>,
                       <span class="st">&quot;cs14&quot;</span>,<span class="st">&quot;cs16&quot;</span>,
                       <span class="st">&quot;pct.gain&quot;</span>,<span class="st">&quot;epsmean&quot;</span>,
                       <span class="st">&quot;qoltot&quot;</span>),
  <span class="dt">static.covariate=</span><span class="kw">c</span>(<span class="st">&quot;exacer&quot;</span>,<span class="st">&quot;Bpansstotal&quot;</span>,
                     <span class="st">&quot;unemployed&quot;</span>),
  <span class="dt">times.exposure=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>), 
  <span class="dt">times.covariate=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>),
  <span class="dt">history=</span><span class="st">&quot;hs&quot;</span>,
  <span class="dt">weight.exposure=</span><span class="st">&quot;wtr&quot;</span>
)
<span class="co">#&gt; Warning in lengthen(input = catie_sim.wh, id = &quot;CATIEID&quot;, diagnostic =</span>
<span class="co">#&gt; 3, : The exposure and/or some covariates contain missing data. Subsequent</span>
<span class="co">#&gt; calculations are not guaranteed to be unbiased in the presence of partially</span>
<span class="co">#&gt; missing data.</span>
<span class="kw">glimpse</span>(catie_sim.whl3 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(CATIEID<span class="op">==</span><span class="dv">1440</span> <span class="op">&amp;</span><span class="st"> </span>name.cov<span class="op">==</span><span class="st">&quot;pct.gain&quot;</span>))
<span class="co">#&gt; Observations: 6</span>
<span class="co">#&gt; Variables: 8</span>
<span class="co">#&gt; $ CATIEID        &lt;chr&gt; &quot;1440&quot;, &quot;1440&quot;, &quot;1440&quot;, &quot;1440&quot;, &quot;1440&quot;, &quot;1440&quot;</span>
<span class="co">#&gt; $ name.cov       &lt;chr&gt; &quot;pct.gain&quot;, &quot;pct.gain&quot;, &quot;pct.gain&quot;, &quot;pct.gain&quot;,...</span>
<span class="co">#&gt; $ time.exposure  &lt;dbl&gt; 0, 1, 1, 3, 3, 3</span>
<span class="co">#&gt; $ time.covariate &lt;dbl&gt; 0, 0, 1, 0, 1, 3</span>
<span class="co">#&gt; $ hs             &lt;chr&gt; &quot;H1&quot;, &quot;H101&quot;, &quot;H101&quot;, &quot;H10101&quot;, &quot;H10101&quot;, &quot;H10101&quot;</span>
<span class="co">#&gt; $ studydisc      &lt;dbl&gt; 0, 0, 0, 1, 1, 1</span>
<span class="co">#&gt; $ value.cov      &lt;dbl&gt; 0.00000000, 0.00000000, 0.01935687, 0.00000000,...</span>
<span class="co">#&gt; $ wtr            &lt;dbl&gt; 1.0039199, 0.9107662, 0.9107662, 1.2994836, 1.2...</span></code></pre></div>
<p>In this new tidy dataset, the weights appear as an extra column, and the static covariates appear as extra rows, but only at the baseline covariate measurement time. The next step is to use <code>omit.history()</code> as we did before to encode our assumption about dependent censoring through the most recently measured temporal covariates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">catie_sim.whlo3 &lt;-<span class="st"> </span><span class="kw">omit.history</span>(
  <span class="dt">input=</span>catie_sim.whl3,
  <span class="dt">covariate.name=</span><span class="kw">c</span>(<span class="st">&quot;phase.change.cum&quot;</span>,<span class="st">&quot;Chg.pansstotal&quot;</span>,<span class="st">&quot;cs14&quot;</span>,<span class="st">&quot;cs16&quot;</span>,<span class="st">&quot;pct.gain&quot;</span>,<span class="st">&quot;epsmean&quot;</span>,<span class="st">&quot;qoltot&quot;</span>),
  <span class="dt">omission=</span><span class="st">&quot;relative&quot;</span>,
  <span class="dt">distance=</span><span class="dv">1</span>
)
<span class="kw">glimpse</span>(catie_sim.whlo3 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(CATIEID<span class="op">==</span><span class="dv">1440</span> <span class="op">&amp;</span><span class="st"> </span>name.cov<span class="op">==</span><span class="st">&quot;pct.gain&quot;</span>))
<span class="co">#&gt; Observations: 3</span>
<span class="co">#&gt; Variables: 8</span>
<span class="co">#&gt; $ CATIEID        &lt;chr&gt; &quot;1440&quot;, &quot;1440&quot;, &quot;1440&quot;</span>
<span class="co">#&gt; $ name.cov       &lt;chr&gt; &quot;pct.gain&quot;, &quot;pct.gain&quot;, &quot;pct.gain&quot;</span>
<span class="co">#&gt; $ time.exposure  &lt;dbl&gt; 0, 1, 3</span>
<span class="co">#&gt; $ time.covariate &lt;dbl&gt; 0, 1, 3</span>
<span class="co">#&gt; $ hs             &lt;chr&gt; &quot;H1&quot;, &quot;H101&quot;, &quot;H10101&quot;</span>
<span class="co">#&gt; $ studydisc      &lt;dbl&gt; 0, 0, 1</span>
<span class="co">#&gt; $ value.cov      &lt;dbl&gt; 0.00000000, 0.01935687, 0.05807060</span>
<span class="co">#&gt; $ wtr            &lt;dbl&gt; 1.0039199, 0.9107662, 1.2994836</span></code></pre></div>
<p>The next step is to use <code>balance()</code> as we did before, but this time with <code>scope=&quot;all&quot;</code> under the restricted set of measurement times, <code>approach=&quot;weight&quot;</code>, and an additional argument <code>weight.exposure</code> to specify the inverse probabilty of censoring weights. Again, in our example we are treating study dropout as the exposure and our data are already implicitly censored by study dropout, which is why we specified <code>censoring=&quot;no&quot;</code>. We have no other censoring mechanisms to incorporate via the <code>censor</code> argument. For the same reason, we have no other inverse probability of censoring weights to incorporate (e.g., due to protocol violation) via the <code>weight.censor</code> argument. In this example, all that is needed is to specify the <code>weight.exposure</code> argument because we are treating study dropout as an exposure and there are no further censoring mechanisms to account for.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">baltbl3 &lt;-<span class="st"> </span><span class="kw">balance</span>(
  <span class="dt">input=</span>catie_sim.whlo3,
  <span class="dt">diagnostic=</span><span class="dv">3</span>,
  <span class="dt">approach=</span><span class="st">&quot;weight&quot;</span>,
  <span class="dt">censoring=</span><span class="st">&quot;no&quot;</span>,
  <span class="dt">scope=</span><span class="st">&quot;all&quot;</span>,
  <span class="dt">exposure=</span><span class="st">&quot;studydisc&quot;</span>,
  <span class="dt">history=</span><span class="st">&quot;hs&quot;</span>,
  <span class="dt">times.exposure=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>),
  <span class="dt">times.covariate=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>),
  <span class="dt">sd.ref=</span><span class="st">&quot;yes&quot;</span>,
  <span class="dt">weight.exposure=</span><span class="st">&quot;wtr&quot;</span>
)
<span class="kw">print</span>(baltbl3 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(name.cov<span class="op">==</span><span class="st">&quot;pct.gain&quot;</span> <span class="op">&amp;</span><span class="st"> </span>time.exposure<span class="op">&lt;=</span><span class="dv">6</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="kw">c</span>(<span class="st">&quot;D&quot;</span>,<span class="st">&quot;SMD&quot;</span>,<span class="st">&quot;N&quot;</span>,<span class="st">&quot;Nexp&quot;</span>),round,<span class="dv">3</span>))
<span class="co">#&gt;    E        H name.cov time.exposure time.covariate      D    SMD       N</span>
<span class="co">#&gt; 1  1       H1 pct.gain             0              0  0.000  0.000 345.893</span>
<span class="co">#&gt; 2  1     H101 pct.gain             1              1 -0.011 -0.222 312.328</span>
<span class="co">#&gt; 3  1   H10101 pct.gain             3              3  0.037  0.258 278.774</span>
<span class="co">#&gt; 4  1 H1010101 pct.gain             6              6 -0.022 -0.074 243.930</span>
<span class="co">#&gt; 5  1       H2 pct.gain             0              0  0.000  0.000 345.862</span>
<span class="co">#&gt; 6  1     H202 pct.gain             1              1 -0.024 -0.448 318.047</span>
<span class="co">#&gt; 7  1   H20202 pct.gain             3              3  0.016  0.102 283.362</span>
<span class="co">#&gt; 8  1 H2020202 pct.gain             6              6  0.075  0.236 252.160</span>
<span class="co">#&gt; 9  1       H3 pct.gain             0              0  0.000  0.000 309.433</span>
<span class="co">#&gt; 10 1     H303 pct.gain             1              1  0.009  0.172 282.142</span>
<span class="co">#&gt; 11 1   H30303 pct.gain             3              3  0.017  0.113 259.506</span>
<span class="co">#&gt; 12 1 H3030303 pct.gain             6              6  0.141  0.544 233.472</span>
<span class="co">#&gt; 13 1       H4 pct.gain             0              0  0.000  0.000 185.533</span>
<span class="co">#&gt; 14 1     H404 pct.gain             1              1 -0.008 -0.148 174.135</span>
<span class="co">#&gt; 15 1   H40404 pct.gain             3              3 -0.043 -0.262 156.578</span>
<span class="co">#&gt; 16 1 H4040404 pct.gain             6              6  0.002  0.006 139.143</span>
<span class="co">#&gt; 17 1       H5 pct.gain             0              0  0.000  0.000 238.766</span>
<span class="co">#&gt; 18 1     H505 pct.gain             1              1  0.000 -0.003 225.239</span>
<span class="co">#&gt; 19 1   H50505 pct.gain             3              3  0.028  0.179 205.156</span>
<span class="co">#&gt; 20 1 H5050505 pct.gain             6              6 -0.040 -0.131 183.302</span>
<span class="co">#&gt;      Nexp</span>
<span class="co">#&gt; 1  30.706</span>
<span class="co">#&gt; 2  32.081</span>
<span class="co">#&gt; 3  34.111</span>
<span class="co">#&gt; 4  20.997</span>
<span class="co">#&gt; 5  25.452</span>
<span class="co">#&gt; 6  34.888</span>
<span class="co">#&gt; 7  29.488</span>
<span class="co">#&gt; 8  18.298</span>
<span class="co">#&gt; 9  23.701</span>
<span class="co">#&gt; 10 22.241</span>
<span class="co">#&gt; 11 23.096</span>
<span class="co">#&gt; 12 13.422</span>
<span class="co">#&gt; 13 13.788</span>
<span class="co">#&gt; 14 13.264</span>
<span class="co">#&gt; 15 11.930</span>
<span class="co">#&gt; 16 12.845</span>
<span class="co">#&gt; 17 12.713</span>
<span class="co">#&gt; 18 15.914</span>
<span class="co">#&gt; 19 21.319</span>
<span class="co">#&gt; 20  8.403</span></code></pre></div>
<p>We are now ready to produce our balance plot via <code>makeplot()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">balplot3 &lt;-<span class="st"> </span><span class="kw">makeplot</span>(
  <span class="dt">input=</span>baltbl3,
  <span class="dt">diagnostic=</span><span class="dv">3</span>,
  <span class="dt">approach=</span><span class="st">&quot;weight&quot;</span>,
  <span class="dt">censoring=</span><span class="st">&quot;no&quot;</span>,
  <span class="dt">scope=</span><span class="st">&quot;all&quot;</span>,
  <span class="dt">label.exposure=</span><span class="st">&quot;Study Dropout&quot;</span>,
  <span class="dt">label.covariate=</span><span class="st">&quot;Covariate&quot;</span>
)
balplot3</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>We see in this plot that the weights have effectively reduced much of the imbalance for most covariates, at least through time 6. However, we also see that strong imbalances persist for other covariates at certain time points and treatment arms, a potential signal that our model for study dropout <a href="https://www.ncbi.nlm.nih.gov/pubmed/?term=19675141">is not flexible enough</a>, or that other issues, such as positivity violations are at play. Imbalances can also persist when inverse probability weights are <a href="https://www.ncbi.nlm.nih.gov/pubmed/?term=18682488">truncated to certain thresholds</a>. The plot is also informative in that we see persistent imbalances across baseline covariates as well. This is to be expected as these variables were used to stabilize the weights. This re-emphasizes the need to condition our final analyses on these baseline covariates.</p>
<p>A natural question is whether we can produce plots that adjust for baseline covariates. There are two options. If there are only a few such covariates and these can be combined into a master categorical variable, this variable can be wrapped into the history strata using either <code>makehistory()</code> function. Averaging over history with <code>balance()</code> will then adjust for this categorical variable. The alternative is to merge baseline covariates to the tidy dataset produced by <code>lengthen()</code>, and then use the <code>broom</code> package to produce balance estimates that adjust for multiple covariates, even continuous ones. If the output were reformatted appropriately, it could be plotted with <code>makeplot()</code> or with <code>ggplot2</code> or <code>lattice</code> directly. This latter extension with modeling has not yet been automated into the software.</p>
<p>In all, assessments such as diagnostics 1 and 3 can be critical for describing the nature of time-varying confounding, and also selection-bias as we have demonstrated in this example. These assessments are certainly of use to investigators who can examine such issues and adapt their modeling approaches accordingly. Next, we turn to diagnostic 2, which tells us even more about the nature of time-varying confounding and/or selection-bias in complex longitudinal data.</p>
</div>
<div id="demonstration-of-diagnostic-2" class="section level3">
<h3>DEMONSTRATION OF DIAGNOSTIC 2</h3>
<p>In addition to describing selection-bias before and after applying inverse probability of censoring weights, we can also examine whether covariates are affected by exposure or an unmeasured cause of exposure. If it were present, conditioning on covariates during follow-up would not only potentially block treatment effects, conditioning would induce selection-bias, and so would not be a desirable approach for resolving the selection-bias. Treatment-confounder feedback motivates the use of inverse probability of censoring weights, or a time-varying application of multiple imputation, to resolve the selection-bias.</p>
<p>To evaluate treatment-confounder feedback, we simply assess the balance of each covariate measurement across each prior exposure measurement, adjusting for confounders that precede the exposure. Thankfully, we can use the same functions (and thus workflow) as before to produce a plot that describes treatment-confounder feedback. Recall that, in our study design, treatment arm is held fixed throughout the study. As a result, the plot will be much simpler than it would be if we wanted to evaluate feedback for a treatment that varied over time. Moreover, because the treatment arm assignment is randomized, there is no need to adjust for baseline covariates via adjustment with inverse probability weights or propensity score strata. In more general settings, we would need to indicate the root name of variables for (i) treatment history and inverse probability of treatment weights or (ii) propensity-score strata to adjust for prior treatment and covariate history that could confound this assessment.</p>
<p>In the presence of study dropout, as in our example, assessments of treatment-confounder feedback can suffer selection-bias. To address this, we include the root name of <code>studydisc</code> and its corresponding inverse probability of censoring weights <code>wtr</code> after having lagged these variables to align with covariate measurements at time <span class="math inline">\(t\)</span> rather than time <span class="math inline">\(t+1\)</span> (as was the case, implicitly, in this example).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">catie.alt &lt;-<span class="st"> </span>catie_sim <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(CATIEID) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(CATIEID,time) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">wtr.lag=</span><span class="kw">ifelse</span>(.data<span class="op">$</span>time<span class="op">==</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="kw">lag</span>(.data<span class="op">$</span>wtr)),
         <span class="dt">studydisc.lag=</span><span class="kw">ifelse</span>(.data<span class="op">$</span>time<span class="op">==</span><span class="dv">0</span>,<span class="dv">0</span>,<span class="kw">lag</span>(.data<span class="op">$</span>studydisc)))
<span class="kw">glimpse</span>(catie.alt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(CATIEID,time,studydisc,studydisc.lag,wtr,wtr.lag,pct.gain) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(CATIEID<span class="op">==</span><span class="dv">1440</span>))  
<span class="co">#&gt; Observations: 3</span>
<span class="co">#&gt; Variables: 7</span>
<span class="co">#&gt; Groups: CATIEID [1]</span>
<span class="co">#&gt; $ CATIEID       &lt;int&gt; 1440, 1440, 1440</span>
<span class="co">#&gt; $ time          &lt;int&gt; 0, 1, 3</span>
<span class="co">#&gt; $ studydisc     &lt;int&gt; 0, 0, 1</span>
<span class="co">#&gt; $ studydisc.lag &lt;dbl&gt; 0, 0, 0</span>
<span class="co">#&gt; $ wtr           &lt;dbl&gt; 1.0039199, 0.9107662, 1.2994836</span>
<span class="co">#&gt; $ wtr.lag       &lt;dbl&gt; 1.0000000, 1.0039199, 0.9107662</span>
<span class="co">#&gt; $ pct.gain      &lt;dbl&gt; 0.00000000, 0.01935687, 0.05807060</span></code></pre></div>
<p>In our example, <code>studydisc.lag</code> becomes a constant of <code>0</code>. However, <code>lengthen()</code> requires a variable describing censoring indicators whenever <code>weight.censor()</code> is used, so we include it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">catie.alt.w &lt;-<span class="st"> </span><span class="kw">widen</span>(
 <span class="dt">input=</span>catie.alt,
 <span class="dt">id=</span><span class="st">&quot;CATIEID&quot;</span>,
 <span class="dt">time=</span><span class="st">&quot;time&quot;</span>,
 <span class="dt">exposure=</span><span class="st">&quot;treat.grp&quot;</span>,
 <span class="dt">covariate=</span><span class="kw">c</span>(<span class="st">&quot;phase.change.cum&quot;</span>,<span class="st">&quot;Chg.pansstotal&quot;</span>,
             <span class="st">&quot;cs14&quot;</span>,<span class="st">&quot;cs16&quot;</span>,
             <span class="st">&quot;pct.gain&quot;</span>,<span class="st">&quot;epsmean&quot;</span>,
             <span class="st">&quot;qoltot&quot;</span>,
             <span class="st">&quot;exacer&quot;</span>,<span class="st">&quot;Bpansstotal&quot;</span>,<span class="st">&quot;unemployed&quot;</span>),
 <span class="dt">censor=</span><span class="st">&quot;studydisc.lag&quot;</span>,
 <span class="dt">weight.censor=</span><span class="st">&quot;wtr.lag&quot;</span>             
)
<span class="co">#&gt; Adding missing grouping variables: `ID`</span>
<span class="kw">glimpse</span>(catie.alt.w <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(CATIEID,<span class="kw">starts_with</span>(<span class="st">&quot;treat.grp&quot;</span>),<span class="kw">starts_with</span>(<span class="st">&quot;studydisc&quot;</span>),<span class="kw">starts_with</span>(<span class="st">&quot;pct.gain&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(CATIEID<span class="op">==</span><span class="dv">1440</span>))
<span class="co">#&gt; Observations: 1</span>
<span class="co">#&gt; Variables: 25</span>
<span class="co">#&gt; $ CATIEID          &lt;int&gt; 1440</span>
<span class="co">#&gt; $ treat.grp_0      &lt;dbl&gt; 1</span>
<span class="co">#&gt; $ treat.grp_1      &lt;dbl&gt; 1</span>
<span class="co">#&gt; $ treat.grp_12     &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ treat.grp_15     &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ treat.grp_18     &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ treat.grp_3      &lt;dbl&gt; 1</span>
<span class="co">#&gt; $ treat.grp_6      &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ treat.grp_9      &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ studydisc.lag_0  &lt;dbl&gt; 0</span>
<span class="co">#&gt; $ studydisc.lag_1  &lt;dbl&gt; 0</span>
<span class="co">#&gt; $ studydisc.lag_12 &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ studydisc.lag_15 &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ studydisc.lag_18 &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ studydisc.lag_3  &lt;dbl&gt; 0</span>
<span class="co">#&gt; $ studydisc.lag_6  &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ studydisc.lag_9  &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ pct.gain_0       &lt;dbl&gt; 0</span>
<span class="co">#&gt; $ pct.gain_1       &lt;dbl&gt; 0.01935687</span>
<span class="co">#&gt; $ pct.gain_12      &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ pct.gain_15      &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ pct.gain_18      &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ pct.gain_3       &lt;dbl&gt; 0.0580706</span>
<span class="co">#&gt; $ pct.gain_6       &lt;dbl&gt; NA</span>
<span class="co">#&gt; $ pct.gain_9       &lt;dbl&gt; NA</span>

catie.alt.wl2 &lt;-<span class="st"> </span><span class="kw">lengthen</span>(
  <span class="dt">input=</span>catie.alt.w,
  <span class="dt">id=</span><span class="st">&quot;CATIEID&quot;</span>,
  <span class="dt">diagnostic=</span><span class="dv">2</span>,
  <span class="dt">censoring=</span><span class="st">&quot;yes&quot;</span>,
  <span class="dt">exposure=</span><span class="st">&quot;treat.grp&quot;</span>,
  <span class="dt">temporal.covariate=</span><span class="kw">c</span>(<span class="st">&quot;phase.change.cum&quot;</span>,<span class="st">&quot;Chg.pansstotal&quot;</span>,
                       <span class="st">&quot;cs14&quot;</span>,<span class="st">&quot;cs16&quot;</span>,
                       <span class="st">&quot;pct.gain&quot;</span>,<span class="st">&quot;epsmean&quot;</span>,
                       <span class="st">&quot;qoltot&quot;</span>),
  <span class="dt">times.exposure=</span><span class="dv">0</span>, 
  <span class="dt">times.covariate=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">15</span>,<span class="dv">18</span>),
  <span class="dt">censor=</span><span class="st">&quot;studydisc.lag&quot;</span>,
  <span class="dt">weight.censor=</span><span class="st">&quot;wtr.lag&quot;</span>
)
<span class="co">#&gt; Warning in lengthen(input = catie.alt.w, id = &quot;CATIEID&quot;, diagnostic = 2, :</span>
<span class="co">#&gt; </span><span class="al">WARNING</span><span class="co">: For diagnostic 2, unless exposure is randomized, specify the root</span>
<span class="co">#&gt; names for (i) exposure history and exposure weights or (ii) strata</span>
<span class="co">#&gt; Warning in lengthen(input = catie.alt.w, id = &quot;CATIEID&quot;, diagnostic =</span>
<span class="co">#&gt; 2, : The exposure and/or some covariates contain missing data. Subsequent</span>
<span class="co">#&gt; calculations are not guaranteed to be unbiased in the presence of partially</span>
<span class="co">#&gt; missing data.</span>
<span class="kw">glimpse</span>(catie.alt.wl2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(CATIEID<span class="op">==</span><span class="dv">1440</span> <span class="op">&amp;</span><span class="st"> </span>name.cov<span class="op">==</span><span class="st">&quot;pct.gain&quot;</span>))
<span class="co">#&gt; Observations: 2</span>
<span class="co">#&gt; Variables: 8</span>
<span class="co">#&gt; $ CATIEID        &lt;chr&gt; &quot;1440&quot;, &quot;1440&quot;</span>
<span class="co">#&gt; $ name.cov       &lt;chr&gt; &quot;pct.gain&quot;, &quot;pct.gain&quot;</span>
<span class="co">#&gt; $ time.exposure  &lt;dbl&gt; 0, 0</span>
<span class="co">#&gt; $ time.covariate &lt;dbl&gt; 1, 3</span>
<span class="co">#&gt; $ treat.grp      &lt;dbl&gt; 1, 1</span>
<span class="co">#&gt; $ value.cov      &lt;dbl&gt; 0.01935687, 0.05807060</span>
<span class="co">#&gt; $ censor         &lt;dbl&gt; 0, 0</span>
<span class="co">#&gt; $ wtr.lag        &lt;dbl&gt; 1.0039199, 0.9107662</span></code></pre></div>
<p><code>lengthen()</code> generally creates a tidy dataset as before, but now restricted to observtions where exposure times precede covariate times. Through our call, We have further restricted the baseline exposure time since it is fixed over time. Furthermore, when <code>lengthen()</code> incorporates weights via <code>weight.censor</code>, it aligns them with measurement times of <em>covariates</em> rather than exposures, in contrast to diagnostic 3. We can skip <code>omit.history()</code> with diagnostic 2 as it is not relevant for assessing treatment-confounder feedback. When exposures vary over time, the balance of all prior exposures needs to be assessed. With our example, we are only concerned with the treatment arm assignment at baseline.</p>
<p>With <code>balance()</code> and <code>makeplot()</code> we have an array of possibilities. Here, we specify <code>scope=&quot;average&quot;</code> and <code>average.over=&quot;distance&quot;</code> to demonstrate how balance metrics can be averaged over person-time, to concisely summarize information over all follow-up times:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">baltbl2 &lt;-<span class="st"> </span><span class="kw">balance</span>(
  <span class="dt">input=</span>catie.alt.wl2,
  <span class="dt">diagnostic=</span><span class="dv">2</span>,
  <span class="dt">approach=</span><span class="st">&quot;none&quot;</span>,
  <span class="dt">censoring=</span><span class="st">&quot;yes&quot;</span>,
  <span class="dt">scope=</span><span class="st">&quot;average&quot;</span>,
  <span class="dt">average.over=</span><span class="st">&quot;distance&quot;</span>,
  <span class="dt">periods=</span><span class="kw">list</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">3</span>,<span class="dv">6</span><span class="op">:</span><span class="dv">9</span>,<span class="dv">12</span><span class="op">:</span><span class="dv">18</span>),
  <span class="dt">exposure=</span><span class="st">&quot;treat.grp&quot;</span>,
  <span class="dt">times.exposure=</span><span class="dv">0</span>,
  <span class="dt">times.covariate=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">15</span>,<span class="dv">18</span>),
  <span class="dt">weight.censor=</span><span class="st">&quot;wtr.lag&quot;</span>,
  <span class="dt">sort.order=</span><span class="kw">c</span>(<span class="st">&quot;Chg.pansstotal&quot;</span>,<span class="st">&quot;cs16&quot;</span>,
               <span class="st">&quot;pct.gain&quot;</span>,<span class="st">&quot;epsmean&quot;</span>,
               <span class="st">&quot;qoltot&quot;</span>,<span class="st">&quot;phase.change.cum&quot;</span>,
               <span class="st">&quot;cs14&quot;</span>)
)
<span class="kw">print</span>(baltbl2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(name.cov<span class="op">==</span><span class="st">&quot;pct.gain&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="kw">c</span>(<span class="st">&quot;D&quot;</span>,<span class="st">&quot;SMD&quot;</span>),round,<span class="dv">3</span>))
<span class="co">#&gt;   period.id period.start period.end name.cov      D    SMD        N</span>
<span class="co">#&gt; 1         1            1          3 pct.gain -0.016 -0.166 4298.928</span>
<span class="co">#&gt; 2         2            6          9 pct.gain -0.059 -0.157 3444.263</span>
<span class="co">#&gt; 3         3           12         18 pct.gain -0.121 -0.168 4376.045</span></code></pre></div>
<p>We also make use of the optional <code>sort.order</code> argument in <code>balance()</code> to order the covariates in the table, which will carry through to <code>makeplot()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">balplot2 &lt;-<span class="st"> </span><span class="kw">makeplot</span>(
  <span class="dt">input=</span>baltbl2,
  <span class="dt">diagnostic=</span><span class="dv">2</span>,
  <span class="dt">approach=</span><span class="st">&quot;none&quot;</span>,
  <span class="dt">censoring=</span><span class="st">&quot;yes&quot;</span>,
  <span class="dt">scope=</span><span class="st">&quot;average&quot;</span>,
  <span class="dt">average.over=</span><span class="st">&quot;distance&quot;</span>,
  <span class="dt">label.exposure=</span><span class="st">&quot;Treatment Group&quot;</span>,
  <span class="dt">label.covariate=</span><span class="st">&quot;Covariate&quot;</span>
)
balplot2</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>In this plot, each panel represents the average balance of a covariate at time <span class="math inline">\(t\)</span> across levels of the treatment arm at baseline (at <span class="math inline">\(t=0\)</span>). We only see one dot because, <code>balance()</code> first computed metrics comparing each non-referent value to a referent value, took a weighted average of these, and then further took weighted averages according to the spacing between treatment arm and covariate measurements. We see that at near and distant intervals, the change in pansstotal score, and the percentage of weight gain, appears to differ across treatment arms. Because this is a randomized study, we do not expect these differences to be attributable to confounding by baseline covariates. Moreover, we have reduced the contribution of selection-bias by incorporating inverse probability of censoring weights. Therefore, it appears that both change in total PANSS score and percentage of weight gain is involved in treatment-confounder feedback.</p>
</div>
</div>
<div id="iterative-processing-for-large-data" class="section level2">
<h2>ITERATIVE PROCESSING FOR LARGE DATA</h2>
<p>One drawback of using a tidy data structure to drive the functions is that, it may take substantial memory to process data from studies with a large number of persons, measurements, and/or covariates. To cope with this, we provide the <code>diagnose()</code> macro that takes the “wide” dataframe and iteratively calls <code>lengthen()</code> and <code>balance()</code> by looping over covariates. In the future we will extend this capability to allow for looping over measurement times as well. The output data from <code>diagnose()</code> can be read directly into <code>makeplot()</code>.</p>
<p>Note that there is an important change in workflow when users wish to use the <code>diagnose()</code> function and also remove irrelevant covariate history from the balance table calculations and plot. Users who wish to do so will need to first use <code>diagnose()</code> with <code>scope=all</code>. Then <code>omit.history()</code> can be applied to the dataset output from <code>diagnose()</code>. From that point, if desired, <code>apply.scope()</code> can be used to restrict to a certain recency or obtain summaries over person-time. This workflow change allows users to iterate while ensuring that the metrics ignore covariate history the user deems irrelevant to confounding.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diagtbl3 &lt;-<span class="st"> </span><span class="kw">diagnose</span>(
  <span class="dt">input=</span>catie_sim.wh,
  <span class="dt">id=</span><span class="st">&quot;CATIEID&quot;</span>,
  <span class="dt">diagnostic=</span><span class="dv">3</span>,
  <span class="dt">approach=</span><span class="st">&quot;weight&quot;</span>,
  <span class="dt">censoring=</span><span class="st">&quot;no&quot;</span>,
  <span class="dt">scope=</span><span class="st">&quot;all&quot;</span>,
  <span class="dt">exposure=</span><span class="st">&quot;studydisc&quot;</span>,
  <span class="dt">history=</span><span class="st">&quot;hs&quot;</span>,
  <span class="dt">temporal.covariate=</span><span class="kw">c</span>(<span class="st">&quot;phase.change.cum&quot;</span>,
                       <span class="st">&quot;Chg.pansstotal&quot;</span>,<span class="st">&quot;cs14&quot;</span>,
                       <span class="st">&quot;cs16&quot;</span>,<span class="st">&quot;pct.gain&quot;</span>,
                       <span class="st">&quot;epsmean&quot;</span>,<span class="st">&quot;qoltot&quot;</span>),
  <span class="dt">times.exposure=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">15</span>,<span class="dv">18</span>),
  <span class="dt">times.covariate=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">15</span>,<span class="dv">18</span>),
  <span class="dt">weight.exposure=</span><span class="st">&quot;wtr&quot;</span>
)
<span class="co">#&gt; Warning in lengthen(input = input, diagnostic = diagnostic, censoring =</span>
<span class="co">#&gt; censoring, : The exposure and/or some covariates contain missing data.</span>
<span class="co">#&gt; Subsequent calculations are not guaranteed to be unbiased in the presence</span>
<span class="co">#&gt; of partially missing data.</span>
<span class="co">#&gt; Warning in balance(input = output.lengthen, diagnostic = diagnostic,</span>
<span class="co">#&gt; approach = approach, : Some exposure times have no exposure variation</span>
<span class="co">#&gt; within levels of exposure history. Estimates for these times will not</span>
<span class="co">#&gt; appear in the results</span>
<span class="co">#&gt; Warning in balance(input = output.lengthen, diagnostic = diagnostic,</span>
<span class="co">#&gt; approach = approach, : SMD values have been set to missing where there is</span>
<span class="co">#&gt; no covariate variation within some level of time-exposure, time-covariate,</span>
<span class="co">#&gt; exposure history, and exposure value; in this case averages for SMD</span>
<span class="co">#&gt; estimates will also appear as missing</span>

diagtbl3.o &lt;-<span class="st"> </span><span class="kw">omit.history</span>(
  <span class="dt">input=</span>diagtbl3,
  <span class="dt">covariate.name=</span><span class="kw">c</span>(<span class="st">&quot;phase.change.cum&quot;</span>,<span class="st">&quot;Chg.pansstotal&quot;</span>,
                   <span class="st">&quot;cs14&quot;</span>,<span class="st">&quot;cs16&quot;</span>,
                   <span class="st">&quot;pct.gain&quot;</span>,<span class="st">&quot;epsmean&quot;</span>,
                   <span class="st">&quot;qoltot&quot;</span>),
  <span class="dt">omission=</span><span class="st">&quot;relative&quot;</span>,
  <span class="dt">distance=</span><span class="dv">1</span>
)

diagtbl3.oa &lt;-<span class="st"> </span><span class="kw">apply.scope</span>(
  <span class="dt">input=</span>diagtbl3,<span class="co">#input=diagtbl3.o,</span>
  <span class="dt">diagnostic=</span><span class="dv">3</span>,
  <span class="dt">approach=</span><span class="st">&quot;weight&quot;</span>,
  <span class="dt">scope=</span><span class="st">&quot;recent&quot;</span>,
  <span class="dt">recency=</span><span class="dv">0</span>
)

diagplot3.oa &lt;-<span class="st"> </span><span class="kw">makeplot</span>(
  <span class="dt">input=</span>diagtbl3.oa,
  <span class="dt">diagnostic=</span><span class="dv">3</span>,
  <span class="dt">approach=</span><span class="st">&quot;weight&quot;</span>,
  <span class="dt">censoring=</span><span class="st">&quot;no&quot;</span>,
  <span class="dt">scope=</span><span class="st">&quot;recent&quot;</span>,
  <span class="dt">average.over=</span><span class="st">&quot;distance&quot;</span>,
  <span class="dt">label.exposure=</span><span class="st">&quot;Treatment Group&quot;</span>,
  <span class="dt">label.covariate=</span><span class="st">&quot;Covariate&quot;</span>
)
diagplot3.oa</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="adapting-data-that-is-not-time-indexed" class="section level2">
<h2>ADAPTING DATA THAT IS NOT TIME-INDEXED</h2>
<p>Sometimes data are not indexed by measurement times. For example, suppose our trial only had one point of follow-up. We might receive a dataset like the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">catie_sim.x &lt;-<span class="st"> </span>catie_sim <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(time<span class="op">==</span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>time)
<span class="kw">print</span>(catie_sim.x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(CATIEID,treat.grp,studydisc,pct.gain,lead.pansstotal) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(CATIEID<span class="op">==</span><span class="dv">1440</span>))
<span class="co">#&gt; # A tibble: 1 x 5</span>
<span class="co">#&gt;   CATIEID treat.grp studydisc pct.gain lead.pansstotal</span>
<span class="co">#&gt;     &lt;int&gt;     &lt;int&gt;     &lt;int&gt;    &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1    1440         1         0        0            54.6</span></code></pre></div>
<p>Let’s say we want to evaluate covariate balance across treatment arms, and then covariate balance across levels of study dropout by visit 1 given treatment arm. All we need to do is add a constant time index to the data, and then we can proceed exactly as we did before. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#add time index, widen, and add history</span>
catie_sim.<span class="dv">0</span> &lt;-<span class="st"> </span>catie_sim.x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">time=</span><span class="dv">0</span>)

catie_sim.<span class="fl">0.</span>w &lt;-<span class="st"> </span><span class="kw">widen</span>(
 <span class="dt">input=</span>catie_sim.<span class="dv">0</span>,
 <span class="dt">id=</span><span class="st">&quot;CATIEID&quot;</span>,
 <span class="dt">time=</span><span class="st">&quot;time&quot;</span>,
 <span class="dt">exposure=</span><span class="kw">c</span>(<span class="st">&quot;studydisc&quot;</span>,<span class="st">&quot;treat.grp&quot;</span>),
 <span class="dt">covariate=</span><span class="kw">c</span>(<span class="st">&quot;cs14&quot;</span>,<span class="st">&quot;cs16&quot;</span>,<span class="st">&quot;weight&quot;</span>,
             <span class="st">&quot;pansstotal&quot;</span>,<span class="st">&quot;epsmean&quot;</span>,
             <span class="st">&quot;qoltot&quot;</span>,
             <span class="st">&quot;exacer&quot;</span>,<span class="st">&quot;unemployed&quot;</span>,
             <span class="st">&quot;white&quot;</span>,<span class="st">&quot;black&quot;</span>,
             <span class="st">&quot;age.grp.1824&quot;</span>,<span class="st">&quot;age.grp.2534&quot;</span>)
) 
<span class="co">#&gt; Adding missing grouping variables: `ID`</span>

catie_sim.<span class="fl">0.</span>wh &lt;-<span class="st"> </span><span class="kw">makehistory.two</span>(
 <span class="dt">input=</span>catie_sim.<span class="fl">0.</span>w,
 <span class="dt">id=</span><span class="st">&quot;CATIEID&quot;</span>,
 <span class="dt">exposure.a=</span><span class="st">&quot;treat.grp&quot;</span>,
 <span class="dt">exposure.b=</span><span class="st">&quot;studydisc&quot;</span>,
 <span class="dt">times=</span><span class="dv">0</span>,
 <span class="dt">name.history.a=</span><span class="st">&quot;ht&quot;</span>,
 <span class="dt">name.history.b=</span><span class="st">&quot;hs&quot;</span>
)

<span class="co">#balance across treatment arm</span>
diagtbl.0t &lt;-<span class="st"> </span><span class="kw">diagnose</span>(
  <span class="dt">input=</span>catie_sim.<span class="fl">0.</span>wh,
  <span class="dt">id=</span><span class="st">&quot;CATIEID&quot;</span>,
  <span class="dt">diagnostic=</span><span class="dv">1</span>,
  <span class="dt">approach=</span><span class="st">&quot;none&quot;</span>,
  <span class="dt">censoring=</span><span class="st">&quot;no&quot;</span>,
  <span class="dt">scope=</span><span class="st">&quot;all&quot;</span>,
  <span class="dt">exposure=</span><span class="st">&quot;treat.grp&quot;</span>,
  <span class="dt">history=</span><span class="st">&quot;ht&quot;</span>,
  <span class="dt">temporal.covariate=</span><span class="kw">c</span>(<span class="st">&quot;phase.change.cum&quot;</span>,<span class="st">&quot;Chg.pansstotal&quot;</span>,
                       <span class="st">&quot;cs14&quot;</span>,<span class="st">&quot;cs16&quot;</span>,<span class="st">&quot;pct.gain&quot;</span>,
                       <span class="st">&quot;epsmean&quot;</span>,<span class="st">&quot;qoltot&quot;</span>),
  <span class="dt">static.covariate=</span><span class="kw">c</span>(<span class="st">&quot;exacer&quot;</span>,<span class="st">&quot;Bpansstotal&quot;</span>,<span class="st">&quot;unemployed&quot;</span>,
                     <span class="st">&quot;white&quot;</span>,<span class="st">&quot;black&quot;</span>,
                     <span class="st">&quot;age.grp1824&quot;</span>,<span class="st">&quot;age.grp.25344&quot;</span>),
  <span class="dt">times.exposure=</span><span class="dv">0</span>,
  <span class="dt">times.covariate=</span><span class="dv">0</span>
)
<span class="kw">glimpse</span>(diagtbl.0t)
<span class="co">#&gt; Observations: 32</span>
<span class="co">#&gt; Variables: 9</span>
<span class="co">#&gt; $ E              &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3,...</span>
<span class="co">#&gt; $ H              &lt;chr&gt; &quot;H&quot;, &quot;H&quot;, &quot;H&quot;, &quot;H&quot;, &quot;H&quot;, &quot;H&quot;, &quot;H&quot;, &quot;H&quot;, &quot;H&quot;, &quot;H...</span>
<span class="co">#&gt; $ name.cov       &lt;fct&gt; black, cs14, cs16, epsmean, exacer, qoltot, une...</span>
<span class="co">#&gt; $ time.exposure  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...</span>
<span class="co">#&gt; $ time.covariate &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...</span>
<span class="co">#&gt; $ D              &lt;dbl&gt; -0.036670426, -0.073590203, 0.031728733, 0.0031...</span>
<span class="co">#&gt; $ SMD            &lt;dbl&gt; -0.077143777, -0.139478048, 0.049935544, 0.0140...</span>
<span class="co">#&gt; $ N              &lt;dbl&gt; 692, 692, 692, 692, 692, 692, 692, 692, 655, 65...</span>
<span class="co">#&gt; $ Nexp           &lt;dbl&gt; 347, 347, 347, 347, 347, 347, 347, 347, 310, 31...</span>

<span class="co">#balance across censoring given treatment arm</span>
diagtbl.0s &lt;-<span class="st"> </span><span class="kw">diagnose</span>(
  <span class="dt">input=</span>catie_sim.<span class="fl">0.</span>wh,
  <span class="dt">id=</span><span class="st">&quot;CATIEID&quot;</span>,
  <span class="dt">diagnostic=</span><span class="dv">1</span>,
  <span class="dt">approach=</span><span class="st">&quot;none&quot;</span>,
  <span class="dt">censoring=</span><span class="st">&quot;no&quot;</span>,
  <span class="dt">scope=</span><span class="st">&quot;all&quot;</span>,
  <span class="dt">exposure=</span><span class="st">&quot;studydisc&quot;</span>,
  <span class="dt">history=</span><span class="st">&quot;hs&quot;</span>,
  <span class="dt">temporal.covariate=</span><span class="kw">c</span>(<span class="st">&quot;phase.change.cum&quot;</span>,<span class="st">&quot;Chg.pansstotal&quot;</span>,
                       <span class="st">&quot;cs14&quot;</span>,<span class="st">&quot;cs16&quot;</span>,<span class="st">&quot;pct.gain&quot;</span>,
                       <span class="st">&quot;epsmean&quot;</span>,<span class="st">&quot;qoltot&quot;</span>),
  <span class="dt">static.covariate=</span><span class="kw">c</span>(<span class="st">&quot;exacer&quot;</span>,<span class="st">&quot;Bpansstotal&quot;</span>,
                     <span class="st">&quot;unemployed&quot;</span>,<span class="st">&quot;white&quot;</span>,<span class="st">&quot;black&quot;</span>,
                     <span class="st">&quot;age.grp1824&quot;</span>,<span class="st">&quot;age.grp.25344&quot;</span>),
  <span class="dt">times.exposure=</span><span class="dv">0</span>,
  <span class="dt">times.covariate=</span><span class="dv">0</span>
)
<span class="kw">glimpse</span>(diagtbl.0s)
<span class="co">#&gt; Observations: 40</span>
<span class="co">#&gt; Variables: 9</span>
<span class="co">#&gt; $ E              &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...</span>
<span class="co">#&gt; $ H              &lt;chr&gt; &quot;H1&quot;, &quot;H1&quot;, &quot;H1&quot;, &quot;H1&quot;, &quot;H1&quot;, &quot;H1&quot;, &quot;H1&quot;, &quot;H1&quot;,...</span>
<span class="co">#&gt; $ name.cov       &lt;fct&gt; black, cs14, cs16, epsmean, exacer, qoltot, une...</span>
<span class="co">#&gt; $ time.exposure  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...</span>
<span class="co">#&gt; $ time.covariate &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...</span>
<span class="co">#&gt; $ D              &lt;dbl&gt; 0.0185508512, -0.0159209271, -0.0408091679, 0.0...</span>
<span class="co">#&gt; $ SMD            &lt;dbl&gt; 0.0384838936, -0.0280695906, -0.0670020166, 0.4...</span>
<span class="co">#&gt; $ N              &lt;dbl&gt; 345, 345, 345, 345, 345, 345, 345, 345, 347, 34...</span>
<span class="co">#&gt; $ Nexp           &lt;dbl&gt; 29, 29, 29, 29, 29, 29, 29, 29, 27, 27, 27, 27,...</span></code></pre></div>
<p>You can use the exact same procedure to appropriately examine covariate balance in a study of multiple distinct exposures, such as interaction or <a href="https://www.ncbi.nlm.nih.gov/pubmed/26035686">mediation</a>.</p>
</div>
</div>
<div id="required-arguments-by-function" class="section level1">
<h1>REQUIRED ARGUMENTS, BY FUNCTION</h1>
<div id="required-arguments-for-lengthen-by-diagnostic-approach-and-censoring-arguments" class="section level2">
<h2>Required arguments for <code>lengthen()</code> by diagnostic, approach, and censoring arguments |</h2>
<table>
<colgroup>
<col width="11%"></col>
<col width="11%"></col>
<col width="11%"></col>
<col width="66%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="left">Diagnostic</th>
<th align="left">Approach</th>
<th align="left">Censoring</th>
<th align="left">Additional Args</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">“none”</td>
<td align="left">“no”</td>
<td align="left">id, exposure, …covariate, times…, history</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">“none”</td>
<td align="left">“yes”</td>
<td align="left">id, exposure, …covariate, times…, history, censor</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">“none”</td>
<td align="left">“no”</td>
<td align="left">id, exposure, …covariate, times…,</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">“none”</td>
<td align="left">“yes”</td>
<td align="left">id, exposure, …covariate, times…, history, censor</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">“weight”</td>
<td align="left">“no”</td>
<td align="left">id, exposure, …covariate, times…, history, weight.exposure</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">“weight”</td>
<td align="left">“yes”</td>
<td align="left">id, exposure, …covariate, times…, history, weight.exposure</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">“stratify”</td>
<td align="left">“no”</td>
<td align="left">id, exposure, …covariate, times…, strata</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">“stratify”</td>
<td align="left">“yes”</td>
<td align="left">id, exposure, …covariate, times…, strata, censor</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">“weight”</td>
<td align="left">“no”</td>
<td align="left">id, exposure, …covariate, times…, history, weight.exposure</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left">“weight”</td>
<td align="left">“yes”</td>
<td align="left">id, exposure, …covariate, times…, history, weight.exposure, censor</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">“stratify”</td>
<td align="left">“no”</td>
<td align="left">id, exposure, …covariate, times…, history, strata</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left">“stratify”</td>
<td align="left">“yes”</td>
<td align="left">id, exposure, …covariate, times…, history, strata, censor</td>
</tr>
</tbody>
</table>
<ul>
<li><p>Either <code>temporal.covariate</code> or <code>static.covariate</code> or both may be specified.</p></li>
<li><p>Both <code>times.exposure</code> and <code>times.covariate</code> must be specified.</p></li>
</ul>
</div>
<div id="required-arguments-for-balance-by-diagnostic-approach-and-censoring-arguments" class="section level2">
<h2>Required arguments for <code>balance()</code> by diagnostic, approach, and censoring arguments |</h2>
<table>
<thead>
<tr class="header">
<th align="left">Diagnostic</th>
<th align="left">Approach</th>
<th align="left">Censoring</th>
<th align="left">Additional Args in addition to Scope</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">“none”</td>
<td align="left">“no”</td>
<td align="left">exposure, times…, history</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">“none”</td>
<td align="left">“yes”</td>
<td align="left">exposure, times…, history, censor</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">“none”</td>
<td align="left">“no”</td>
<td align="left">exposure, times..,</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">“none”</td>
<td align="left">“yes”</td>
<td align="left">exposure, times…, history, censor</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">“weight”</td>
<td align="left">“no”</td>
<td align="left">exposure, times…, history, weight.exposure</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">“weight”</td>
<td align="left">“yes”</td>
<td align="left">exposure, times…, history, weight.exposure</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">“stratify”</td>
<td align="left">“no”</td>
<td align="left">exposure, times…, strata</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">“stratify”</td>
<td align="left">“yes”</td>
<td align="left">exposure, times…, strata, censor</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">“weight”</td>
<td align="left">“no”</td>
<td align="left">exposure, times…, history, weight.exposure</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left">“weight”</td>
<td align="left">“yes”</td>
<td align="left">exposure, times…, history, weight.exposure, censor</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">“stratify”</td>
<td align="left">“no”</td>
<td align="left">exposure, times…, history, strata</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left">“stratify”</td>
<td align="left">“yes”</td>
<td align="left">exposure, times…, history, strata, censor</td>
</tr>
</tbody>
</table>
<ul>
<li><p>Specifying <code>scope=“average”</code> will require the <code>average.over</code> argument.</p></li>
<li><p>Specifying <code>average.over=&quot;distance&quot;</code> allows for optional use of the <code>periods</code> argument.</p></li>
<li><p>Specifying <code>scope=recent</code> will require the <code>recency</code> argument.</p></li>
</ul>
</div>
<div id="required-arguments-for-balance-by-diagnostic-approach-and-censoring-arguments-1" class="section level2">
<h2>Required arguments for <code>balance()</code> by diagnostic, approach, and censoring arguments |</h2>
<table style="width:100%;">
<colgroup>
<col width="13%"></col>
<col width="14%"></col>
<col width="13%"></col>
<col width="57%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="left">Diagnostic</th>
<th align="left">Approach</th>
<th align="left">Censoring</th>
<th align="left">Additional Args in addition to Scope <em>and</em> Metric</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">“none”</td>
<td align="left">“no”</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">“none”</td>
<td align="left">“yes”</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">“none”</td>
<td align="left">“no”</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">“none”</td>
<td align="left">“yes”</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">“weight”</td>
<td align="left">“no”</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">“weight”</td>
<td align="left">“yes”</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">“stratify”</td>
<td align="left">“no”</td>
<td align="left">stratum</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">“stratify”</td>
<td align="left">“yes”</td>
<td align="left">stratum</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">“weight”</td>
<td align="left">“no”</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left">“weight”</td>
<td align="left">“yes”</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">“stratify”</td>
<td align="left">“no”</td>
<td align="left">stratum</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left">“stratify”</td>
<td align="left">“yes”</td>
<td align="left">stratum</td>
</tr>
</tbody>
</table>
<ul>
<li>Specifying <code>scope=“average”</code> will require the <code>average.over</code> argument.</li>
</ul>
</div>
<div id="requirements-for-other-functions" class="section level2">
<h2>Requirements for other functions</h2>
<p>Generally, <code>apply.scope()</code> will follow <code>balance()</code>. <code>diagnose()</code> will follow the combination of <code>lengthen()</code> and <code>balance()</code>.</p>
</div>
</div>
<div id="using-lengthen-with-models-instead-of-balance" class="section level1">
<h1>USING <code>lengthen()</code> WITH MODELS INSTEAD OF <code>balance()</code></h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
stdcov &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  y &lt;-<span class="st"> </span>(x<span class="op">-</span><span class="kw">mean</span>(x))<span class="op">/</span><span class="kw">sd</span>(x)
}

catie_sim.s &lt;-<span class="st"> </span>catie_sim <span class="op">%&gt;%</span>
<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Chg.pansstotal=</span><span class="kw">stdcov</span>(.data<span class="op">$</span>Chg.pansstotal),
  <span class="dt">cs14=</span><span class="kw">stdcov</span>(.data<span class="op">$</span>cs14),
  <span class="dt">cs16=</span><span class="kw">stdcov</span>(.data<span class="op">$</span>cs16),
  <span class="dt">pct.gain=</span><span class="kw">stdcov</span>(.data<span class="op">$</span>pct.gain),
  <span class="dt">epsmean=</span><span class="kw">stdcov</span>(.data<span class="op">$</span>epsmean),
  <span class="dt">qoltot=</span><span class="kw">stdcov</span>(.data<span class="op">$</span>qoltot)
)

catie_sim.sw &lt;-<span class="st"> </span><span class="kw">widen</span>(
 <span class="dt">input=</span>catie_sim.s,
 <span class="dt">id=</span><span class="st">&quot;CATIEID&quot;</span>,
 <span class="dt">time=</span><span class="st">&quot;time&quot;</span>,
 <span class="dt">exposure=</span><span class="st">&quot;studydisc&quot;</span>,
 <span class="dt">covariate=</span><span class="kw">c</span>(<span class="st">&quot;treat.grp&quot;</span>,<span class="st">&quot;phase.change.cum&quot;</span>,
             <span class="st">&quot;Chg.pansstotal&quot;</span>,
             <span class="st">&quot;cs14&quot;</span>,<span class="st">&quot;cs16&quot;</span>,
             <span class="st">&quot;pct.gain&quot;</span>,<span class="st">&quot;epsmean&quot;</span>,<span class="st">&quot;qoltot&quot;</span>,
             <span class="st">&quot;exacer&quot;</span>,<span class="st">&quot;Bpansstotal&quot;</span>,
             <span class="st">&quot;unemployed&quot;</span>),
 <span class="dt">weight.exposure=</span><span class="st">&quot;wtr&quot;</span>             
)
<span class="co">#&gt; Adding missing grouping variables: `ID`</span>

catie_sim.swh &lt;-<span class="st"> </span><span class="kw">makehistory.two</span>(
 <span class="dt">input=</span>catie_sim.sw,
 <span class="dt">id=</span><span class="st">&quot;CATIEID&quot;</span>,
 <span class="dt">exposure.a=</span><span class="st">&quot;treat.grp&quot;</span>,
 <span class="dt">exposure.b=</span><span class="st">&quot;studydisc&quot;</span>,
 <span class="dt">times=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">15</span>,<span class="dv">18</span>),
 <span class="dt">name.history.a=</span><span class="st">&quot;ht&quot;</span>,
 <span class="dt">name.history.b=</span><span class="st">&quot;hs&quot;</span>
)

catie_sim.swhl3 &lt;-<span class="st"> </span><span class="kw">lengthen</span>(
  <span class="dt">input=</span>catie_sim.swh,
  <span class="dt">id=</span><span class="st">&quot;CATIEID&quot;</span>,
  <span class="dt">diagnostic=</span><span class="dv">3</span>,
  <span class="dt">censoring=</span><span class="st">&quot;no&quot;</span>,
  <span class="dt">exposure=</span><span class="st">&quot;studydisc&quot;</span>,
  <span class="dt">temporal.covariate=</span><span class="kw">c</span>(<span class="st">&quot;phase.change.cum&quot;</span>,<span class="st">&quot;Chg.pansstotal&quot;</span>,
                       <span class="st">&quot;cs14&quot;</span>,<span class="st">&quot;cs16&quot;</span>,<span class="st">&quot;pct.gain&quot;</span>,
                       <span class="st">&quot;epsmean&quot;</span>,<span class="st">&quot;qoltot&quot;</span>),
  <span class="dt">times.exposure=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">15</span>,<span class="dv">18</span>), 
  <span class="dt">times.covariate=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">15</span>,<span class="dv">18</span>),
  <span class="dt">history=</span><span class="st">&quot;hs&quot;</span>,
  <span class="dt">weight.exposure=</span><span class="st">&quot;wtr&quot;</span>
)
<span class="co">#&gt; Warning in lengthen(input = catie_sim.swh, id = &quot;CATIEID&quot;, diagnostic =</span>
<span class="co">#&gt; 3, : The exposure and/or some covariates contain missing data. Subsequent</span>
<span class="co">#&gt; calculations are not guaranteed to be unbiased in the presence of partially</span>
<span class="co">#&gt; missing data.</span>

catie_sim.swhlo3 &lt;-<span class="st"> </span><span class="kw">omit.history</span>(
  <span class="dt">input=</span>catie_sim.swhl3,
  <span class="dt">covariate.name=</span><span class="kw">c</span>(<span class="st">&quot;phase.change.cum&quot;</span>,<span class="st">&quot;Chg.pansstotal&quot;</span>,
                   <span class="st">&quot;cs14&quot;</span>,<span class="st">&quot;cs16&quot;</span>,<span class="st">&quot;pct.gain&quot;</span>,
                   <span class="st">&quot;epsmean&quot;</span>,<span class="st">&quot;qoltot&quot;</span>),
  <span class="dt">omission=</span><span class="st">&quot;relative&quot;</span>,
  <span class="dt">distance=</span><span class="st">&quot;1&quot;</span>
)</code></pre></div>
<p>Here is the model-based SMD (via the <code>broom</code> package):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">library</span>(broom)

modtbl &lt;-<span class="st"> </span>catie_sim.swhlo3 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">time=</span>time.exposure,
         <span class="dt">history=</span>hs) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(name.cov,history,time) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">lm</span>(<span class="dt">formula=</span>value.cov<span class="op">~</span>studydisc,<span class="dt">weights=</span>wtr,.))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(term<span class="op">==</span><span class="st">&quot;studydisc&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(name.cov,time,history,term,estimate) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">E=</span><span class="kw">ifelse</span>(term<span class="op">==</span><span class="st">&quot;studydisc&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>),
         <span class="dt">time.exposure=</span>time,
         <span class="dt">time.covariate=</span>time,
         <span class="dt">H=</span>history,
         <span class="dt">SMD=</span>estimate)<span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">select</span>(<span class="op">-</span>term,time,history) <span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">ungroup</span>()
<span class="co">#&gt; Warning in summary.lm(x): essentially perfect fit: summary may be</span>
<span class="co">#&gt; unreliable</span>

<span class="co">#&gt; Warning in summary.lm(x): essentially perfect fit: summary may be</span>
<span class="co">#&gt; unreliable</span>

<span class="co">#&gt; Warning in summary.lm(x): essentially perfect fit: summary may be</span>
<span class="co">#&gt; unreliable</span>

<span class="co">#&gt; Warning in summary.lm(x): essentially perfect fit: summary may be</span>
<span class="co">#&gt; unreliable</span>

<span class="co">#&gt; Warning in summary.lm(x): essentially perfect fit: summary may be</span>
<span class="co">#&gt; unreliable</span>

<span class="co">#&gt; Warning in summary.lm(x): essentially perfect fit: summary may be</span>
<span class="co">#&gt; unreliable</span>

<span class="co">#&gt; Warning in summary.lm(x): essentially perfect fit: summary may be</span>
<span class="co">#&gt; unreliable</span>

<span class="co">#&gt; Warning in summary.lm(x): essentially perfect fit: summary may be</span>
<span class="co">#&gt; unreliable</span>

<span class="co">#&gt; Warning in summary.lm(x): essentially perfect fit: summary may be</span>
<span class="co">#&gt; unreliable</span>
<span class="kw">print</span>(modtbl)
<span class="co">#&gt; # A tibble: 273 x 9</span>
<span class="co">#&gt;    name.cov  time history  estimate     E time.exposure time.covariate</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Chg.pan~     0 H1       1.14e-17     1             0              0</span>
<span class="co">#&gt;  2 Chg.pan~     1 H101    -2.31e- 4     1             1              1</span>
<span class="co">#&gt;  3 Chg.pan~     3 H10101  -4.07e- 2     1             3              3</span>
<span class="co">#&gt;  4 Chg.pan~     6 H10101~  1.74e- 1     1             6              6</span>
<span class="co">#&gt;  5 Chg.pan~     9 H10101~ -9.04e- 4     1             9              9</span>
<span class="co">#&gt;  6 Chg.pan~    12 H10101~  9.44e- 4     1            12             12</span>
<span class="co">#&gt;  7 Chg.pan~    15 H10101~  9.67e- 2     1            15             15</span>
<span class="co">#&gt;  8 Chg.pan~    18 H10101~ -1.31e- 2     1            18             18</span>
<span class="co">#&gt;  9 Chg.pan~     0 H2       1.26e-17     1             0              0</span>
<span class="co">#&gt; 10 Chg.pan~     1 H202     2.79e- 2     1             1              1</span>
<span class="co">#&gt; # ... with 263 more rows, and 2 more variables: H &lt;chr&gt;, SMD &lt;dbl&gt;</span></code></pre></div>
<p>Because we have formatted the table to like the output from <code>balance()</code>, we can read this directly into <code>makeplot()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">modplot &lt;-<span class="st"> </span><span class="kw">makeplot</span>(
  <span class="dt">input=</span>modtbl,
  <span class="dt">diagnostic=</span><span class="dv">3</span>,
  <span class="dt">approach=</span><span class="st">&quot;weight&quot;</span>,
  <span class="dt">censoring=</span><span class="st">&quot;no&quot;</span>,
  <span class="dt">scope=</span><span class="st">&quot;recent&quot;</span>,
  <span class="dt">label.exposure=</span><span class="st">&quot;Treatment Group&quot;</span>,
  <span class="dt">label.covariate=</span><span class="st">&quot;Covariate&quot;</span>
)
modplot</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>As implemented, this approach mimicks what the balance function would do–estimate balance within each level of time and history. However, if we moved history and/or time from the <code>group_by()</code> statement to the right-hand side of the model, we would begin to incorporate assumptions about model form and its constancy across covariates. Our estimates would rely on these assumptions being correct. The chief advantage of this approach is that, with some merging of baseline covariates to the lengthened dataset, we can leverage our assumptions to condition balance estimates on several covariates, including continuous ones, when this is desired.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
